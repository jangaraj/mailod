<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
  <HEAD>
  <TITLE>Slu¾by mailového servera</TITLE>
    
    <META NAME="Author" CONTENT="VIX">
    <META http-equiv="Content-type" CONTENT="text/html; charset=iso-8859-2">
    <META NAME="Generator" CONTENT="VIM">
    <META NAME="Signature" CONTENT="Burning-Eye">
    <LINK REL="Stylesheet" TYPE="text/css" HREF="prirucka.css">
  </HEAD>
  
  <BODY BGCOLOR="#f0f0d0" TEXT="black" LINK="#0000f0" ALINK="#f00000"
  VLINK="#000080">
  <P ALIGN="right" style="font-weight: bold">Príruèka systémového administrátora, <b>1.8.10</b></P>


  
  <A NAME="top"></A>
  <H1 ALIGN="center">6. Slu¾by mailového servera<img src="updatedx.gif" alt="[UPDATE]" border="0"></H1>
  <P ALIGN="right"><SMALL>Posledná zmena: 29/1/2006</SMALL></P>
<UL>
<LI TYPE="disc"> <A HREF="#top">6. Slu¾by mailového servera<img src="updatedx.gif" alt="[UPDATE]" border="0"></A> 
 <UL>
 <LI TYPE="disc"> <A HREF="#mail_source">6.1 Cesta mailu od odosielateµa k príjemcovi</A> 
  <LI TYPE="disc"> <A HREF="#smtp_server">6.2 SMTP server "Postfix"</A>
  <UL>
  <LI TYPE="disc"> <A HREF="#smtp_basics">6.2.0 Základy SMTP protokolu</A> 
   <LI TYPE="disc"> <A HREF="#postfix_intro">6.2.1 Filozofia servera "<code>Postfix</code>"</A>
   <LI TYPE="disc"> <A HREF="#postfix_daemons">6.2.2 Obslu¾né démony</A>
   <LI TYPE="disc"> <A HREF="#postfix_files">6.2.3 Adresáre a súbory</A>
   <LI TYPE="disc"> <A HREF="#postfix_scripts">6.2.4 Obsluha Postfixu</A>
   <UL>
   <LI TYPE="disc"> <A HREF="#postfix_scripts_2">6.2.4.1 ©tartovacie skripty</A> 
    <LI TYPE="disc"> <A HREF="#postfix_databases">6.2.4.2 Vytváranie databáz pre Postfix</A>
    </UL>
    <LI TYPE="disc"> <A HREF="#postfix_config">6.2.5 Konfigurácia</A>
   <UL>
   <LI TYPE="disc"> <A HREF="#postfix_main">6.2.5.1 Syntax konfiguraèného súboru "<code>/etc/postfix/main.cf</code>"</A> 
    <LI TYPE="disc"> <A HREF="#postfix_main_checklist">6.2.5.2 Postup pri nastavovaní</A>
    <UL>
    <LI TYPE="disc"> <A HREF="#postfix_main_names">6.2.5.2.1 Základné nastavenia Vá¹ho mailového servera</A> 
     <LI TYPE="disc"> <A HREF="#postfix_main_domains">6.2.5.2.2 Ktoré domény rozpoznáva Vá¹ mailový server?</A>
     <LI TYPE="disc"> <A HREF="#postfix_main_transport_maps">6.2.5.2.3 Pre aké domény je Vá¹ mailový server prostredníkom a preposiela ich na ïal¹ie mailové servery (napr. vo vnútornej sieti)?</A>
     <LI TYPE="disc"> <A HREF="#postfix_main_smtp_relay">6.2.5.2.4 Ako odosiela Vá¹ mailový server po¹tu? Smeruje ju na mailový server Vá¹ho poskytovateµa, alebo ju odosiela sám?</A>
     <LI TYPE="disc"> <A HREF="#postfix_main_smtp_clients">6.2.5.2.5 Aké poèítaèe sa mô¾u pripája» na Vá¹ mailový server a vyu¾íva» slu¾bu SMTP?</A>
     <LI TYPE="disc"> <A HREF="#postfix_aliases">6.2.5.2.6 Aliasy a virtuálne adresy (domény)</A>
     <LI TYPE="disc"> <A HREF="#postfix_canonical">6.2.5.2.7 "Pekné adresy" v tvare Meno.Priezvisko</A>
     <LI TYPE="disc"> <A HREF="#postfix_main_restrictions">6.2.5.2.8 Chcete nastavi» obmedzenia na príjem a posielanie po¹ty? Tieto Vám pomô¾u
      zbavi» sa èasti SPAMu.</A>
     <LI TYPE="disc"> <A HREF="#postfix_main_size_limits">6.2.5.2.9 Obmedzenia spracovania mailov (veµkosti, èasy)</A>
     <LI TYPE="disc"> <A HREF="#postfix_main_mda">6.2.5.2.10 Ako sa doruèujú maily do pou¾ívateµských schránok? (Umiestnenie, formát
      a program, ktorý mail spracuje mô¾u by» rôzne.</A>
     <LI TYPE="disc"> <A HREF="#postfix_main_virus_spam">6.2.5.2.11 Vy¾adujete antivírovú a antispamovú kontrolu?</A>
     <LI TYPE="disc"> <A HREF="#postfix_main_other">6.2.5.2.12 Ostatné direktívy v konfiguraènom súbore</A>
     </UL>
     <LI TYPE="disc"> <A HREF="#postfix_complete_example">6.2.5.3 Kompletný príklad konfiguraèného súboru</A>
    <LI TYPE="disc"> <A HREF="#postfix_queue">6.2.5.4 Nedoruèené maily a rie¹enie problémov</A>
    <LI TYPE="disc"> <A HREF="#postfix_body_checks">6.2.5.5 Jednoduchá "ochrana proti vírusom"</A>
    <LI TYPE="disc"> <A HREF="#postfix_master">6.2.5.6 Konfiguraèný súbor démonov</A>
    <UL>
    <LI TYPE="disc"> <A HREF="#postfix_chroot">6.2.5.6.1 Chroot pre "<code>postfix</code>"</A> 
     </UL>
     </UL>
     </UL>
     <LI TYPE="disc"> <A HREF="#spam_definition">6.3 SPAM - nevy¾iadaná po¹ta</A>
  <UL>
  <LI TYPE="disc"> <A HREF="#spam_getting">6.3.1 Ako sa SPAM dostane do mailboxu?</A> 
   <LI TYPE="disc"> <A HREF="#spam_detect">6.3.2 Detekcia a filtrovanie SPAMov</A>
   <LI TYPE="disc"> <A HREF="#spamassassin_install">6.3.3 In¹talácia programu SpamAssassin</A>
   <LI TYPE="disc"> <A HREF="#spamassassin_procmail">6.3.4 Prepojenie programu SpamAssassin s programom na doruèovanie po¹ty</A>
   <UL>
   <LI TYPE="disc"> <A HREF="#spamassassin_procmail_example">6.3.4.1 SpamAssassin a Procmail</A> 
    <LI TYPE="disc"> <A HREF="#spamassassin_maildrop_example">6.3.4.2 SpamAssassin a Maildrop</A>
    </UL>
    <LI TYPE="disc"> <A HREF="#spamassassin_optimize">6.3.5 Optimalizácia výkonu programu SpamAssassin</A>
   <LI TYPE="disc"> <A HREF="#spamassassin_tweaking">6.3.6 Ladenie programu SpamAssassin</A>
   <UL>
   <LI TYPE="disc"> <A HREF="#spamassassin_tweaking_config">6.3.6.2 Konfiguraèný súbor programu SpamAssassin</A> 
    <LI TYPE="disc"> <A HREF="#spamassassin_tweaking_learning">6.3.6.3 Uèenie sa na vzorkách</A>
    </UL>
    </UL>
    <LI TYPE="disc"> <A HREF="#pop3imap">6.4 Slu¾by na výber mailov (POP3, IMAP)</A>
  <UL>
  <LI TYPE="disc"> <A HREF="#pop3imap_tcpwrapped">6.4.1 Obmedzenie prístupu k slu¾bám POP3 a IMAP</A> 
   <LI TYPE="disc"> <A HREF="#stunnel">6.4.2 Tunelovanie &amp; ¹ifrovanie: stunnel</A>
   <UL>
   <LI TYPE="disc"> <A HREF="#stunnel_config">6.4.2.1 Konfigurácia</A> 
    <UL>
    <LI TYPE="disc"> <A HREF="#stunnel_config_standalone">6.4.2.1.1 Samostatne spú¹»aný démon</A> 
     <LI TYPE="disc"> <A HREF="#stunnel_conf_inetd">6.4.2.1.2 Spú¹»anie "<code>stunnel</code>" z "<code>inetd</code>"</A>
     </UL>
     <LI TYPE="disc"> <A HREF="#stunnel_certificate">6.4.2.2 Vytvorenie certifikátu</A>
    <LI TYPE="disc"> <A HREF="#stunnel_client_config">6.4.2.3 Konfigurácia klienta</A>
    </UL>
    <LI TYPE="disc"> <A HREF="#stunnel_combined">6.4.3 Kombinovaný prístup</A>
   </UL>
   </UL>
   </UL>


<a name="mail_source"></a>
<h2>6.1 Cesta mailu od odosielateµa k príjemcovi</h2>

<p align="justify">
Keï sa mail vydá na svoju èasovo ohranièenú pú», zaèína ako textový súbor,
ktorý napí¹e odosielateµ vo svojom mailovom klientovi (<a
    href="http://www.microsoft.com">Microsoft Outlook Express</a>, <a
    href="http://www.microsoft.com">Microsoft Outlook</a>, <a
    href="http://www.mozilla.org">Mozilla</a>, <a
    href="http://www.ximian.com/products/evolution/">Evolution</a>, <a
    href="http://www.mozilla.org/products/thunderbird/">Thunderbird</a>, <a
    href="http://www.mutt.org">Mutt</a>, <a
    href="http://www.washington.edu/pine/">Pine</a> a mnohé ïal¹ie). Povedzme,
¾e mail, o ktorom hovoríme, je urèený pre príjemcu
"<code>pokus@example.com</code>". Mailový klient sa pripojí na mailový
server odosielateµa pomocou protokolu SMTP (v nastavení klienta bude nieèo ako "SMTP
server" alebo "odchádzajúci server") a odovzdá mu mail. Keï ho SMTP server
prevezme, úloha mailového klienta je skonèená, aspoò pokiaµ ide o odoslanie
po¹ty.

<p align="justify">
Mailový server odosielateµa spracuje mailovú správu: skontroluje IP adresu
odosielateµa, aby sa presvedèil, ¾e tento odosielateµ má právo vyu¾íva» SMTP
server na odosielanie po¹ty do Internetu (túto kontrolu mô¾e vykonáva» u¾
poèas prijímania mailu), skontroluje veµkos», prípadne vykoná testovanie
obsahu mailu na prítomnos» vírusov, nevy¾iadanej reklamy a pod., a na základe
adresy príjemcu zistí, akému po¹tovému serveru mail doruèí. Tu mô¾u nasta» tri
prípady:</p>
<ol>
    <li> mail je urèený príjemcovi priamo na tom istom serveri alebo príjemcovi,
    ktorého doménu obsluhuje mailový server odosielateµa. Mail sa nebude preposiela» do
    Internetu, ale spracuje sa lokálne a ulo¾í do mailboxu.
    <li> mailový server odosielateµa zistí z DNS "MX" záznam pre adresu príjemcu (bez
    mena pou¾ívateµa a zavináèa, teda "example.com") - "MX" záznam urèuje meno
    servera, ktorý prijíma po¹tu pre danú doménu. Ak "MX" záznam neexistuje,
    pokúsi sa získa» "A" záznam pre adresu príjemcu.
    Skontaktuje sa s týmto serverom a odovzdá mu mail. 
    <li> mailový server odosielateµa nedoká¾e zisti», komu má doruèi» mail (nenastal ¾iaden
    z vy¹¹ie uvedených prípadov) a podµa toho, aká chyba nastala, sa pokúsi
    o doruèenie neskôr (doèasná chyba, napr. nedostatok voµného miesta na
    disku alebo chyba pri kontaktovaní DNS servera), alebo vráti mail odosielateµovi
    (permanentná chyba, napr. cieµový mailový server nepozná príjemcu alebo má
    prekroèenú kvótu).
</ol>

<pre>
+-------------------+  smtp   +--------------------------+
| klientský program | ------&gt; | SMTP server odosielateµa | 
+-------------------+         +--------------------------+
                                           |
                                           |smtp
                                           v
                              +---------------------------+
                              | ( SMTP servery na ceste ) |
                              +---------------------------+
                                           |
                                           |smtp
                       pop3                v
+-------------------+  imap   +---------------------------+
| klientský program | &lt;-----  |   SMTP server prijemcu    |
+-------------------+         +---------------------------+
</pre>

<p align="justify">
Po tom, ako sa mail dostane na mailový server príjemcu, nastáva posledná fáza
prenosu po¹ty, a tou je výber po¹ty pomocou protokolov POP3 alebo IMAP.
(Existuje aj mo¾nos» priameho èítania mailu na serveri, to v¹ak vyu¾íva
pomerne málo pou¾ívateµov, preto¾e potrebuju shellovský prístup na server. Typické
vyu¾itie je napr. na ¹kolských serveroch, nie v¹ak vo firmách ani
u poskytovateµov Internetu).

<A NAME="smtp_server"></A>
<H2>6.2 SMTP server "Postfix"</H2>

<P ALIGN="justify">
Prvou zo slu¾ieb mailového servera, ktoré si opí¹eme, bude SMTP (Simple Mail
Transfer Protocol), èi¾e slu¾ba zasielania po¹ty. SMTP zabezpeèuje doruèenie
mailu od okamihu, ako ho získa od klientského programu. Vo v¹eobecnosti mo¾no
poveda», ¾e maily sú uchovávané v doèasných súboroch na disku, a¾ kým ich SMTP
server nezaène spracováva». SMTP server sa pokúsi doruèi» mail pripojením na
ïal¹í (najèastej¹ie cieµový) mail server a ak sa mu to podarí, je v¹etko
v poriadku. V opaènom prípade sa odosielateµovi mail vráti spolu s chybovým
hlásením (najèastej¹ie kvôli neexistujúcemu adresátovi).
</P>

<a name="smtp_basics"></a>
<H3>6.2.0 Základy SMTP protokolu</H3>
<P ALIGN="justify">
Pred tým, ako klient zaène posiela» mail povedzme na adresu "vix at vazka.sk",
zistí si adresu mailového servera pre túto doménu:</P>

<pre class="example">
% host -t mx vazka.sk
vazka.sk mail is handled by 10 twin.vazka.sk.
</pre>

<p align="justify">
Teraz poznáme mailový server domény "vazka.sk". Na ten sa budeme pripája».
Nasleduje príklad celej SMTP relácie, neskôr si ju rozoberieme po jednotlivých
príkazoch.</p>

<p class="pozor" align="justify">
<b>Upozornenie!</b> Keï¾e sa dnes veµmi mno¾ia SPAMy, nahradím v príklade
v reálnych adresách v¹etky zavináèe textom "at" a bodky v doménových menách "dot".
</p>

<pre class="example">
[vix@hudson ~/web-data/sysadmin]$ telnet twin.vazka.sk 25
Trying 195.20.166.130...
Connected to twin.vazka.sk (195.20.166.130).
Escape character is '^]'.
220 twin.vazka.sk ESMTP Postfix (1.1.11)
helo bgs.sk
250 twin.vazka.sk
mail from: noris at bgs dot sk
250 Ok
rcpt to: vix at vazka dot sk
250 Ok
data
354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
From: noris at bgs dot sk
To: vix at vazka dot sk
Subject: testovacia SMTP relacia
 
Hello world!
.
250 Ok: queued as D6F621FB89
quit
221 Bye
Connection closed by foreign host.
</pre>

<p align="justify">
A teraz postupne, po jednotlivých krokoch.
Klient sa pripojí na mailový server danej domény na port 25. To isté vieme
simulova» klasickým príkazom <code><b>"telnet"</b></code>:</p>

<pre class="example">
[vix@hudson ~/web-data/sysadmin]$ telnet twin.vazka.sk 25
Trying 195.20.166.130...
Connected to twin.vazka.sk (195.20.166.130).
Escape character is '^]'.
</pre>

<p align="justify">
Mailový server povolil klientovi TCP spojenie...</p>

<pre class="example">
220 twin.vazka.sk ESMTP Postfix (1.1.11)
</pre>

<p align="justify">
... a predstavil sa. (V¹etky hlásenia SMTP servera sú oznaèené chybovým kódom
(v tomto prípade "220"), ktorý je na zaèiatku riadku. Tento kód je zaujímavý
najmä pre skutoèné mailové programy, preto¾e je ¹tandardizovaný a nemenný, kým
hlásenia rôznych mailových serverov sú samozrejme odli¹né.) Teraz sa predstaví
klient pomocou príkazu "HELO". Server odpovedá, ¾e je v¹etko Ok.</p>

<pre class="example">
<b>helo bgs.sk</b>
250 twin.vazka.sk
</pre>

<p align="justify">
Klient zadá odosielateµa mailu príkazom "MAIL FROM". Server odpovedá, ¾e je v¹etko
Ok.</p>

<pre class="example">
<b>mail from: noris at bgs dot sk</b>
250 Ok
</pre>

<p align="justify">
Klient zadá príjemcu mailu príkazom "RCPT TO:". Server odpovedá, ¾e je v¹etko Ok.</p>

<pre class="example">
<b>rcpt to: vix at vazka dot sk</b>
250 Ok
</pre>

<p align="justify">
Zadávame príkaz "DATA". Server prijal príkaz a vyzve klienta na zadanie samotného
mailu - hlavièiek a tela. Mail sa ukonèí zadaním znaku "." na samostatnom
riadku.</p>

<pre class="example">
<b>data</b>
354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;

From: noris at bgs dot sk
To: vix at vazka dot sk
Subject: testovacia SMTP relacia
 
Hello world!
.
</pre>

<p align="justify">
Mail bol prijatý do frontu správ.</p>

<pre class="example">
250 Ok: queued as D6F621FB89
</pre>

<p align="justify">
Klient ukonèí reláciu so serverom:

<pre class="example">
quit
</pre>

<p align="justify">
Server pozdraví a zatvorí spojenie.</p>

<pre class="example">
221 Bye
Connection closed by foreign host.
</pre>

<P ALIGN="justify">
Keï¾e sa sna¾íme o èo najlep¹ie zabezpeèenie servera, opí¹eme si nastavenie
SMTP servera, ktorý je pokladaný za veµmi bezpeèný. Navy¹e je aj dobre a µahko
konfigurovateµný a s jeho èinnos»ou som nadmieru spokojný u¾ niekoµko rokov.
Jeho meno je - "<code><a href="http://www.postfix.org/">Postfix</a></code>".

<A NAME="postfix_intro"></A>
<H3>6.2.1 Filozofia servera "<code>Postfix</code>"</H3>

  <P ALIGN="justify">
  Základnými princípmi mailového servera "<code>Postfix</code>" sú:
  jednoduchos», modulárnos» a bezpeènos». Na rozdiel od niektorých iných systémov
  (typický priklad: "<code>sendmail</code>"), ktoré fungujú ako jeden proces
  obsluhúci po¾iadavky na posielanie i prijímanie mailov, sa skladá
  z niekoµkých modulov, prièom ka¾dý robí jednu, presne ¹pecifikovanú
  èinnos». Pri takomto prístupe je zabezpeèená prehµadnos» zdrojového kódu
  jednotlivých procesov a aj zvý¹ená bezpeènos», preto¾e chyba v jednom
  module nemusí ovplyvni» ostatné, kým pri jednom monolitickom programe
  mô¾e fatálne následky spôsobi» jediná chyba. Nevýhodou monolitického
  rie¹enia je aj to, ¾e celý program be¾í s právami jedného pou¾ívateµa
  (root), hoci niektoré jeho èasti to vôbec nevy¾adujú.

  <A NAME="postfix_daemons"></A>
  <H3>6.2.2 Obslu¾né démony</H3>

  <P ALIGN="justify">
  "<code>Postfix</code>" je implementovaný ako jeden hlavný server (proces
  "<code>master</code>"), ktorý spú¹»a obslu¾né démony vykonávajúce ¹pecifické
  operácie podµa potreby. Tento prístup pripomína "<code><A
  HREF="services.html#inetdvsstandalone">inetd</A></code>" a konfiguraèný
  súbor servera "<code>master</code>" nie náhodou tak trochu pripomína aj
  "<code>inetd.conf</code>" :)

  <P ALIGN="justify">
  Jednotlivé slu¾by sa spú¹»ajú ako samostatné procesy a zabezpeèujú napr.
  posielanie a prijímanie mailov z Internetu, doruèovanie lokálnych mailov
  atï. Poèet procesov, ktoré daný typ po¾iadavky obsluhujú, je urèený
  konfiguráciou.

  <p align="justify">
  Struèný popis funkcie niektorých démonov (vyèerpávajúce informácie nájdete
  v manuálových stránkach):</p>
  
  <ul>
      <li> <b>smtpd:</b> poèúva na porte a prijíma SMTP po¾iadavky. V¹etky prijaté
      správy sú presmerované na démona "cleanup"
      <li> <b>pickup:</b> èaká na lokálne napísané maily a presmeruje
      ich obsah na démona "cleanup"
      <li> <b>cleanup:</b> spracúva prijatý mail (pridáva chýbajúce hlavièky a pod.),
      vkladá ho do frontu prijatých
      mailov a informuje démona "qmgr" o jeho príchode
      <li> <b>qmgr:</b> èaká na prijaté maily a zabezpeèuje ich doruèenie. Spôsob
      doruèenia urèí démon "trivial-rewrite"
      <li> <b>trivial-rewrite:</b> prepisuje adresu do ¹tandardizovanej formy. Démon
      pripája meno domény k lokálnym mailom bez jej uvedenia a pod. Okrem toho
      urèuje, èo sa stane s mailom, ako a kam sa bude doruèova» na základe
      adresy
      <li> <b>local:</b> doruèuje mail do lokálnych schránok na serveri
      <li> <b>smtp:</b> smtp klient Postfixu. Doruèuje maily z mailového frontu, ktoré
      sú urèené pre iné mailové servery.
  </ul>

  <A NAME="postfix_files"></A>
  <H3>6.2.3 Adresáre a súbory</H3>

  <P ALIGN="justify">
  Pri typickej in¹talácii "<code>postfixu</code>" sa pou¾ívajú tieto adresáre
  a súbory (niektoré mo¾no zmeni» v konfigurácii):

  <UL>
  <LI> <code>/etc/postfix</code>: adresár s konfiguraènými súbormi
  <LI> <code>/etc/postfix/master.cf</code>: hlavný konfiguraèný súbor slu¾ieb, nastavenia
  jednotlivých slu¾ieb (napr. aj to, èi bude daná slu¾ba be¾a» vo vyhradenom
  adresári - <a href="#postfix_chroot">chroot</a>)
  <LI> <code>/etc/postfix/main.cf</code>: hlavný konfiguraèný súbor "<code>postfixu</code>"
  s nastaveniami doruèovania a odosielania po¹ty
  <LI> <code>/etc/aliases</code>: súbor s mailovými aliasmi pou¾ívateµov platnými pre
  lokálny poèítaè
  <LI> <code>/etc/postfix/*</code>: v¹etky ostatné súbory v tomto adresári sú tabuµky
  "<code>postfixu</code>" v textovom a databázovom tvare (db, dbm)
  <LI> <code>/var/spool/postfix/</code>: hlavný adresár s dátovými ¹truktúrami
  "<code>postfixu</code>" poèas jeho prevádzky. Sú tu ulo¾ené v¹etky práve
  doruèované, prijímané a nedoruèiteµné maily. Tento adresár slú¾i ako
  základný adresár pre jednotlivé slu¾by - tie vyu¾ívajú jeho podadresáre.
  </UL>

  <A NAME="postfix_scripts"></A>
  <H3>6.2.4 Obsluha Postfixu</H3>

  <P ALIGN="justify">
  S Postfixom mô¾ete vykonáva» tieto be¾né operácie:</P>
  <UL>
  <LI> Spustenie démona: "<b><code>/etc/init.d/postfix start</code></b>"
  <LI> Zastavenie démona: "<b><code>/etc/init.d/postfix stop</code></b>"
  <LI> Re¹tartovanie démona: "<b><code>/etc/init.d/postfix restart</code></b>"
  <LI> Opätovné nahratie konfigurácie démona (po zmenách v konfigurácii):
  "<b><code>/etc/init.d/postfix reload</code></b>"
  <LI> Kontrola konfiguraèných súborov: "<b><code>postfix check</code></b>"
  <LI> (Pokus o) doruèenie v¹etkých èakajúcich neodoslaných mailov (napríklad
  po odstránení nejakej chyby na va¹om serveri/sieti): "<b><code>postfix
  flush</code></b>"
  <LI> Aktualizácia aliasovej databázy ("<code>/etc/aliases</code>",
  "<code>/etc/postfix/aliases.*</code>"): "<b><code>newaliases</code></b>"
  <LI> Aktualizácia inej databázy ("<code>/etc/postfix/*</code>",
  "<code>/etc/postfix/*.db</code>"): "<b><code>cd /etc/postfix ; postmap meno_suboru</code></b>"
  <li> Výpis stavu mailového frontu: "<code><b>mailq</b></code>"
  </UL>

  <a name="postfix_scripts_2"></a>
  <h4>6.2.4.1 ©tartovacie skripty</h4>
  <P ALIGN="justify">
  Doteraz ste boli zvyknutí na "init" skripty nachádzajúce sa v adresári
  "<code>/etc/init.d</code>", pomocou ktorých ste spú¹»ali a zastavovali jednotlivé démony.
  "<code>postfix</code>" má takýto skript tie¾, v skutoènosti v¹ak spú¹»a program
  "<code>postfix</code>", ktorý sám o sebe podporuje parametre "start", "stop", "reload"
  a ïal¹ie. Na svoje si teda prídu aj tí, ktorí nepou¾ívajú ¹tartovacie
  skripty, napríklad pou¾ívatelia distribúcie Slackware.

  <P ALIGN="justify">
  ©tartovací skript "<code>/etc/init.d/postfix</code>" okrem samotného
  spú¹»ania/zastavovania procesu "<code>master</code>" vykonáva aj ïal¹ie tzv.
  "údr¾bárske" operácie, napríklad pri ¹tarte "<code>postfixu</code>" sa aktualizujú
  databázy vytvárané z konfiguraèných súborov (typicky "<code>/etc/postfix/*.db</code>").

  <a name="postfix_databases"></a>
  <h4>6.2.4.2 Vytváranie databáz pre Postfix</h4>

  <P ALIGN="justify">
  Niektoré nastavenia Postfixu nenájdete v konfiguraènom súbore ale
  v "databázach". Aby bolo jasné, tieto "databázy" v skutoènosti vznikajú
  tie¾ z textových súborov, sú v¹ak ulo¾ené v binárnej forme, oddelene od
  hlavného konfiguráku a ich formát je pre èloveka neèitateµný. Postfix v¹ak
  k údajom v týchto súboroch vie pristupova» rýchlej¹ie ako k textovým
  súborom. V ïal¹om texte si úvodzovky odpustím a aj keï tieto súbory nie sú
  relaènými databázami, budem tieto súbory nazýva» jednoducho databázy.

  <P ALIGN="justify">
  Databázy sa vytvárajú z textových súborov (tieto konfigurujete Vy) pomocou
  príkazov:</P>
  <ul>
      <li> <code><b>newaliases</b></code> (¹peciálne pre databázu aliasov)
      <li> <code><b>postmap textovy_subor</b></code> (pre v¹etky ostatné databázy)
  </ul>
  
  <P ALIGN="justify">
  Vytvorená databáza má rovnaké meno ako originálny textový súbor a príponu
  ".db" (ak ide o databázu typu "hash") resp. ".pag" a ".dir" (ak ide o databázu typu
  "dbm").

  <P ALIGN="justify">
  Databázy <b>musíte vytvori»</b> (vygenerova») <b>po ka¾dej zmene</b> originálnych
  textových súborov. Po vygenerovaní databázy treba aktualizova» konfiguráciu
  Postfixu príkazom "<code><b>postfix reload</b></code>". (Mô¾ete tie¾ pár
  minút poèka», Postfix by si mal konfiguráciu aktualizova» sám.)

  <p class="poznamka">
  <b>Poznámka:</b> ak v konfigurácii Postfixu spomeniete databázové súbory,
  musia tieto databázy existova» u¾ pred spustením Postfixu. V opaènom prípade
  pri prvom prístupe k nim dôjde k chybe a proces, ktorý s nimi potrebuje
  pracova», ukonèí svoju èinnos» s chybovým hlásením ("<code>bad command
      startup -- throttling</code>"
  - zaznamená sa do logu). Takéto chyby sa bez sledovania logov nesmierne
    »a¾ko hµadajú, preto¾e po spustení Postfixu v¹etko vyzerá dobre - a¾ do
    prvého pokusu o prijatie alebo odoslanie mailu.
  </p>
  
  <p class="poznamka">
  <b>Poznámka:</b> v najjednoduch¹ej konfigurácii (a èasto aj pri tých nároènej¹ích)
  si vystaèíte s databázou aliasov. Na druhej strane, v prípade, ¾e budete
  chcie» odmieta» prijímanie mailov z urèitých adries a pod., databázam sa
  nevyhnete.

  <A NAME="postfix_config"></A>
  <H3>6.2.5 Konfigurácia</H3>

  <P ALIGN="justify">
  Server "<code>Postfix</code>" sa konfiguruje veµmi µahko a v svi¾nom tempe.
  Pokiaµ nepotrebujete nejaké ¹pecialitky, v zásade staèí zmeni» niekoµko
  parametrov a "<code>Postfix</code>" je pripravený. V tom spoèíva hlavná
  výhoda oproti "<code>sendmailu</code>", kde síce tie¾ postaèí nájs» zopár
  parametrov, ale budú sa Vám hµada» dos» »a¾ko.

  <A NAME="postfix_main"></A>
  <H4>6.2.5.1 Syntax konfiguraèného súboru "<code>/etc/postfix/main.cf</code>"</H4>

  <P ALIGN="justify">
  Hlavný konfiguraèný súbor s nastavením "<code>Postfixu</code>" obsahuje mno¾stvo
  direktív, z ktorých najdôle¾itej¹ie sú prednastavené autorom balíèka.
  Jednotlivé direktívy su µahko èitateµné pre správcu systému. Nasledujúce
  príklady pochádzajú z mojej in¹talácie "<code>postfixu</code>" a obsahujú veµa zmien
  oproti pôvodným nastaveniam. Ak budete chcie» experimentova», v adresári
  s dokumentáciou ("<code>/usr/doc/postfix/samples</code>", resp.
  "<code>/usr/doc/postfix/examples</code>" nájdete mnoho príkladov, z ktorých
  som èerpal aj ja. Súbory sú komentované a ak sa vám z nich nieèo zapáèi,
  mô¾ete nastavenie pou¾i» v hlavnom konfiguraènom súbore.

  <P ALIGN="justify">
  Pri písaní direktív majte na pamäti:</P>
  <OL>
  <LI> direktíva má tvar "<code>parameter = hodnota</code>".
  <li> ak je hodnotou zoznam, polo¾ky sa oddeµujú èiarkou alebo medzerou.
  <LI> riadky zaèínajúce medzerami znamenajú, ¾e sú pokraèovaním
  predchádzajúceho riadku. Takto mô¾ete prehµadne zapísa» dlhé riadky, typicky
  s viacerými polo¾kami zoznamu.
  <LI> hodnoty niektorých direktív mô¾u obsahova» referenciu na iné premenné pomocou
  <code>$premenná</code> - v takom prípade sa namiesto $premenná pou¾ije jej
  hodnota.
  <LI> hodnotou premennej mô¾e by» meno súboru (absolútna cesta) v tvare
  "<code>parameter = /cesta/k/suboru</code>", v ktorom sa nachádzajú
  po¾adované údaje (na ka¾dom riadku jeden). To sa hodí napríklad vtedy, ak
  chcete niektoré údaje pre "<code>postfix</code>" generova» napríklad pomocou
  iných programov.
  <LI> hodnotou premennej mô¾e by» databáza (absolútna cesta) v tvare
  "<code>parameter = typdb:/cesta/k/databaze</code>", v ktorej sa nachádzajú
  po¾adované údaje (na ka¾dom riadku kµúè a hodnota oddelené medzerami alebo
  tabulátormi. Ak sa nájde kµúè, vráti sa hodnota). Typ databázy je najèastej¹ie "hash" alebo "dbm". Táto databáza
  je uchovaná v textovej aj binárnej forme, Postfix pou¾íva binárnu formu.
  <LI> hodnotou premennej mô¾e by» súbor s regulárnymi výrazmi (absolútna
  cesta) v tvare "<code>parameter = typrv:/cesta/k/suboru</code>", v ktorom sa
  nachádzajú po¾adované údaje (na ka¾dom riadku výraz a výsledok oddelené
  medzerami alebo tabulátormi. Ak sa nájde kµúè, vráti sa výsledok). Postfix
  podporuje typy "regexp" a "pcre" (Perl compatible regular expressions
  - Perlovské regulárne výrazy). Pre "pcre" potrebujete nain¹talova» aj
  balíèek "<code>postfix-pcre</code>"
  </OL>


  <a name="postfix_main_checklist"></a>
  <h4>6.2.5.2 Postup pri nastavovaní</h4>

  <p align="justify">
  Najprv si musíte zodpoveda» na nasledujúce otázky:</p>

  <a name="postfix_main_names"></a>
  <h5>6.2.5.2.1 Základné nastavenia Vá¹ho mailového servera</h5>

  <p align="justify">
  Nasledujúce nastavenia sú bezpodmieneène nutné pre beh Postfixu. Urèujú
  najmä adresy, meno servera, meno domény a podobné vecièky.
  Venujte im, prosím, zvý¹enú pozornos». Sú to veci jednoduché, ale aj pri tých
  sa dá urobi» kritická chyba (t.j. Postfix nebude fungova» ako má).</p>

  <dl>
      <dt> <b>myhostname</b> = server.example.com</dt>
      <dd> urèuje plné meno servera. ©tandardne sa pou¾ije meno servera
      získané z Vá¹ho operaèného systému (príkaz
      <code><b>hostname</b></code>)</dd>
      <dt> <b>mydomain</b> = example.com</dt>
      <dd> urèuje doménové meno servera. ©tandardne je to hodnota premennej
      <b>$myhostname</b> bez prvej zlo¾ky (mena serveru)</dd>
      <dt> <b>myorigin</b> = $myhostname</dt>
      <dd> urèuje meno servera v odchádzajúcej po¹te z tohto servera. Toto
      meno sa pripája za meno pou¾ívateµa, ak nebola v adrese odosielateµa
      ¹pecifikovaná doména. ©tandardne je to hodnota premennej <b>$myhostname</b>.</dd>
      <dt> <b>inet_interfaces</b> = all</dt>
      <dd> zoznam <i>adries</i> (nie eth0 a pod!) sie»ových rozhraní, na
      ktorých sa prijíma po¹ta. ©tandardne: na v¹etkých.</dd>
      <dt> <b>append_at_myorigin</b> = yes</dt>
      <dd> nahradenie adresy typu "user" adresou "user@$mydomain". Toto upraví
      adresy odosielateµov v mailoch odchádzajúcich z Vá¹ho mailového servera
      tak, aby sa na ne dalo odpoveda». Toto by v¹ak mali robi» mailové
      programy, ktoré be¾ia na serveri (napr. ak posielate po¹tu priamo zo
      servera).</dd>
      <dt> <b>append_dot_mydomain</b> = yes</dt>
      <dd> nahradenie adresy typu "user@server" adresou
      "user@server.$mydomain". Toto by malo prepísa» adresy odosielateµov
      v mailoch prechádzajúcich z Vá¹ho intranetu do Internetu tak, aby sa na
      ne dalo odpoveda». Pridávanie domény by sa v¹ak malo robi» iba
      v nevyhnutných prípadoch, ka¾dý mailový klient v sieti má ma» v adresách
      doménu u¾ nastavenú!</dd>
      <dt> <b>masquerade_domains</b> = $mydomain</dt>
      <dd> zoznam domén, z ktorých má by» pri posielaní mailov cez Vá¹ server
      odstránená subdoménová èas» z hlavièiek (napr. ak je <b>mydomain</b> =
      "sub.example.com", vznikne "example.com"). Ak pou¾ijete tento parameter,
      musíte samozrejme zabezpeèi» príjem/preposlanie mailov aj pre
      pou¾ívateµov, ktorým ste takto skrátili adresy.</dd>
      
 </dl>

 <a name="postfix_main_domains"></a>
 <h5>6.2.5.2.2 Ktoré domény rozpoznáva Vá¹ mailový server?</h5>

 <p align="justify">
 Nasledujúce nastavenia urèujú domény, ktoré Postfix bude rozpoznáva» pri
 prijímaní a relayovaní po¹ty.</p>
 
 <dl>
     <dt> <b>mydestination</b> = $myhostname, $mydomain, mail.$mydomain, localhost</dt>
     <dd> doménové adresy, ktoré Postfix pova¾uje za lokálne a pre ktoré
     prijíma po¹tu. Ak nesprávne nastavíte túto premennú, Vá¹ mailový server
     nebude prijíma» po¹tu.</dd>
     <dt> <b>relay_domains</b> = $mydestination</dt>
     <dd> doménové adresy, pre ktoré Postfix umo¾òuje relay (príjem po¹ty na
     ïal¹ie spracovanie, okrem príjmu na lokálny server napr. preposielanie
     po¹ty urèenej serveru, pre ktorý je Postfix zálo¾ným serverom a pod.).
     ©tandardná hodnota tejto premennej je rovnaká ako
     <b>mydestination</b>.</dd>
     <dd> Pravidlá relayu v Postfixe:
     <ol>
         <li> Postfix povoµuje relay pre klientov, ktorých IP adresa vyhovuje <b>$mynetworks</b>
         <li> Postfix povoµuje relay pre domény z premennej <b>$relay_domains</b>
         <li> Postfix povoµuje posiela» maily pre v¹etkých ostatných klientov
         NA adresy uvedené v $relay_domains a ich subdomény
         <li> Postfix prijíma maily pre adresy, ktoré vyhovujú premennej <b>$inet_interfaces</b>
         <li> Postfix prijíma maily pre adresy v <b>$mydestination</b>
         <li> Postfix prijíma maily pre adresy uvedené v <b>$virtual_maps</b>
     </ol>

     <p align="justify">Inými slovami: relay je povolený iba v prípade, ¾e je
     <i>odosielateµ alebo príjemca lokálnym pou¾ívateµom</i> (definuje
     premenná <b>$mynetworks</b>).</p>

     <b>Poznámka:</b> ak máte problém s prijímanim po¹ty pre Va¹u doménu,
     pravdepodobne máte nesprávne nastavenú premennú <b>relay_domains</b> alebo
     <b>mydestination</b>.</dd>
 </dl>

 <a name="postfix_main_transport_maps"></a>
 <h5>6.2.5.2.3 Pre aké domény je Vá¹ mailový server prostredníkom a preposiela ich na ïal¹ie mailové servery (napr. vo vnútornej sieti)?</h5>
      
      <dl>
          <dt> <b>transport_maps</b> = hash:/etc/postfix/transport</dt>
          <dd> urèenie databázy s popisom transportných máp
      </dl>
      
<pre class="example">
/etc/postfix/main.cf:
mydestination = mail.example2.com, mail.example3.com
relay_domains = example2.com, example3.com

/etc/postfix/transport:
example2.com      smtp:[10.0.0.1]
.example3.com     smtp:[192.168.0.1]

postmap /etc/postfix/transport
postfix reload
</pre>

      <p align="justify">
      Tento príklad bude smerova» v¹etku po¹tu pre <b>doménu</b>
      "<code>example2.com</code>" na ïal¹í mailový server s adresou "10.0.0.1"
      (hranaté zátvorky zabránia zis»ovaniu MX záznamov a musia by» pou¾ité,
      ak uvádzate IP adresu.) a v¹etku po¹tu pre <b>doménu a subdomény</b>
      "<code>example3.com</code>" na ïal¹í mailový server s adresou
      "192.168.0.1". Uvedené domény <b>musia</b> by» zahrnuté v premennej
      <b>relay_domains</b> a zároveò nesmú by» v <b>mydestination</b> - ak by
      tam boli, bude ich zachytáva» Postfix a <b>nebude ich preposiela»
          na uvedené servery napriek nastaveniu transportnej mapy</b>.</p>

      <p align="justify">
      Po vytvorení mapy nezabudnite vytvori» jej databázovú formu
      ("<code><b>postmap /etc/postfix/transport</b></code>") a reloadnú»
      Postfix.</p>

      <a name="postfix_main_smtp_relay"></a>
      <h5>6.2.5.2.4 Ako odosiela Vá¹ mailový server po¹tu? Smeruje ju na mailový server Vá¹ho poskytovateµa, alebo ju odosiela sám?</h5>

      <p align="justify">
      V niektorých situáciách (a sie»ach) je vhodné alebo potrebné, aby
      Postfix pri odosielaní mailov do Internetu komunikoval iba s jediným
      mailovým sevrerom - nadradeným serverom - napr. poskytovateµa Internetu.
      Výhodou je, ¾e mo¾no upravi» nastavenia firewallu, preto¾e odchádzajúce
      SMTP spojenie pôjde iba na jeden server, a tie¾ nie je potrebné
      prevádzkova» na Va¹om serveri DNS (staèí ma» IP adresu nadradeného
      servera). Nevýhodou je samozrejme "úzke hrdlo" komunikácie - ak zlyhá
      spojenie s nadradeným serverom, alebo ak je mimo prevádzky,
      o odosielaní mailov sa Vám mô¾e len sníva».</p>

  <dl>
      <dt> <b>relayhost</b> = upstream.example.com</dt>
      <dd> adresa servera, ktorému Postfix odovzdáva v¹etku odchádzajúcu
      po¹tu, ktorú nevie doruèi» pomocou mapy "transport". Typicky mô¾e ís»
      o mailový server poskytovateµa Vá¹ho pripojenia k Internetu. Ak tento
      parameter chýba alebo je jeho hodnota prázdna (default), Postfix
      doruèuje odchádzajúcu po¹tu sám.</dd>
  </dl>

  <a name="postfix_main_smtp_clients"></a>
  <h5>6.2.5.2.5 Aké poèítaèe sa mô¾u pripája» na Vá¹ mailový server a vyu¾íva» slu¾bu SMTP?</h5>

  <dl>
      <dt> <b>mynetworks</b> = 10.0.0.0/24, 127.0.0.0/8</dt>
      <dd> adresy klientských poèítaèov, ktoré mô¾u pomocou Postfixu odosiela»
      po¹tu (pomocou SMTP). Ak nesprávne nastavíte túto premennú, Postfix
      neumo¾ní klientom posiela» po¹tu (odmietne pripojenie).
  </dl>

  <a name="postfix_aliases"></a>
  <h5>6.2.5.2.6 Aliasy a virtuálne adresy (domény)</h5>

  <p align="justify">
  Aliasy su virtuálne mailové adresy na Va¹om mailovom serveri. Pomocou
  aliasovej mapy Postfix prijme po¹tu pre neexistujúceho pou¾ívateµa a doruèí
  ju tomu pou¾ívateµovi, pre ktorého je vytvorený tento alias. Aliasy sú
  najèastej¹ie ulo¾ené v súbore "<code>/etc/aliases</code>". Ak si tento súbor
  pozriete, v¹imnite si, ¾e v ka¾dej in¹talácii Linuxu u¾ existuje niekoµko
  aliasov. Ide vo v¹eobecnosti o presmerovanie po¹ty pre systémových
  pou¾ívateµov na adresu administrátora systému.</p>

  <dl>
      <dt> <b>alias_maps</b> = hash:/etc/aliases</dt>
      <dt> <b>alias_maps</b> = dbm:/etc/aliases</dt>
      <dd> urèuje umiestnenie databázy aliasov. Databáza typu "hash" má
      príponu ".db", databáza typu "dbm" má príponu ".pag" a ".dir"</dd>

      <dt> <b>alias_database</b> = hash:/etc/aliases</dt>
      <dt> <b>alias_database</b> = dbm:/etc/aliases</dt>
      <dd> urèuje umiestnenie databázy aliasov, ktorá sa vytvorí po spustení
      programu "<code><b>newaliases</b></code>". Tento parameter je síce
      uvedený oddelene od predchádzajúceho, preto¾e mô¾e ma» aj inú hodnotu
      (niektoré typy databáz - nie "hash" ani "dbm" nemusia by» pod kontrolou
      Postfixu). Databáza typu "hash" má príponu ".db", databáza typu "dbm" má
      príponu ".pag" a ".dir"</dd>
  </dl>

  <p align="justify">
  Konfiguraèný súbor postfixu "<code>/etc/aliases</code>" obsahuje mailové
  aliasy platné pre vá¹ server. Umo¾òuje vám vytvori» si µubovoµný poèet
  "falo¹ných" adries, ktoré budú doruèované fyzickému
  pou¾ívateµovi/pou¾ívateµom. Napríklad si mô¾ete vytvori» alias "webmaster",
  prièom pou¾ívateµ "webmaster" nebude existova». Ka¾dý alias sa nachádza na
  samostatnom riadku a za dvojbodkou nasleduje pou¾ívateµ alebo zoznam
  pou¾ívateµov (oddelených èiarkou), komu sa má po¹ta doruèova».</P>

  
  <pre class="example">
/etc/aliases:
MAILER-DAEMON:  postmaster
postmaster:     root
abuse: root

root: vix,karol
webmaster: vix
pokus: pokus@example.com

<b>newaliases</b>
</pre>

  <P ALIGN="justify">
  V predchádzajúcej uká¾ke som definoval alias "MAILER-DAEMON", ktorého po¹ta
  sa doruèuje pou¾ívateµovi "postmaster", ktorého po¹ta sa doruèuje
  pou¾ívateµovi "root", ktorého po¹ta sa v¹ak doruèuje pou¾ívateµom "vix"
  a "karol". (Postfix si zistí koneèného príjemcu a po¹le to priamo jemu, bez
  zlo¾itej a nezmyselnej postupnosti, ktorú som naèrtol.) <b>Definujeme aj alias
  "abuse", ktorý sa pou¾íva pri komunikácii s administrátorom servera
  v prípade, ¾e nejaký ná¹ pou¾ívateµ poru¹uje sie»ovú etiketu</b> (napr. posiela
  z na¹ej siete SPAM). Nasleduje spomínaný alias "webmaster", ktorého po¹ta sa
  doruèuje pou¾ívateµovi "vix". Adresa pre pou¾ívateµa "pokus" sa posiela
  automaticky na adresu "pokus@example.com".
  
  <P ALIGN="justify">
  Zdôrazòujem, ¾e v predchádzajúcom príklade pou¾ívatelia "abuse", "webmaster"
  a "pokus" nemusia vôbec existova» - a ani by nemali, preto¾e by sa k svojim
  mailom na serveri nikdy nedostali. Postfix by ich doruèil na adresy uvedené
  v aliasoch. Naproti tomu pou¾ívatelia uvedení na pravej strane aliasov
  ("vix" a "karol") musia existova»!
  
  <P ALIGN="justify">
  Takýmto spôsobom si mô¾ete necha» doruèova» správcovské maily (a chybové
  hlásenia programov zasielané rootovi) na be¾nú adresu (tak¾e nemusíte pod
  rootom pou¾íva» mailové programy); nemusíte vytvára» kontá typu "webmaster"
  a mô¾ete automaticky forwardova» maily pre u¾ neexistujúcich pou¾ívateµov na
  iné adresy mimo vá¹ho servera.
  
  <P ALIGN="justify">
  V aliasoch mô¾ete definova» aj iné ¹peciality, napríklad pri doruèení mailu
  na nejaký alias sa mô¾e spusti» program, ktorý "nieèo" urobí. Tieto detaily
  v¹ak momentálne nepotrebujeme a tak ich odsunieme do kategórie "osobných
  zvrhlostí".

  <P ALIGN="justify">
  Postfix tie¾ umo¾òuje prijíma» maily pre tzv. "virtuálne domény". Ide
  o domény, ktoré majú ako MX záznam v DNS uvedený Vá¹ mailový server, ale
  vy¾adujete ¹peciálne spracovanie mailov pre tieto domény. Napríklad chcete,
  aby v rámci virtuálnej domény existovali iba niekoµkí pou¾ívatelia (nemusia
  by» toto¾ní s pou¾ívateµmi na mailovom serveri), alebo chcete prijíma» maily
  pre celú doménu a uchováva» ich v jednej schránke (doménový kô¹).</P>
  
  <dl>
      <dt> <b>virtual_maps</b> = hash:/etc/postfix/virtual</dt>
      <dd> urèuje umiestnenie databázy so zoznamom virtuálnych domén</dd>
  </dl>

  <pre class="example">
/etc/postfix/virtual:
virtualexample.com              akykolvektext
@virtualexample.com             somebody@example.com
 
virtualexample2.com             akykolvektext
someone@virtualexample2.com     someoneelse@example3.com

virtualexample3.com             akykolvektext
@virtualexample3.com            ja@virtualexample3.com

<b>postmap /etc/postfix/virtual
postfix reload</b>
  </pre>

  <p align="justify">
  V tomto príklade sme zadefinovali tri virtuálne domény:</p>

  <ol>
      <li> Doména
  "virtualexample.com" je urèená na prijatie mailu pre akéhokoµvek pou¾ívateµa na
  "@virtualexample.com" (Postfix nebude vraca» po¹tu pre neexistujúcich
  pou¾ívateµov) a v¹etky tieto maily budú doruèené pou¾ívateµovi
  "somebody@example.com".
  
  <li> Doména "virtualexample2.com" umo¾òuje výhradne príjem na
  adresu "someone@virtualexample2.com" a v¹etky takéto maily preposiela na adresu
  "someoneelse@example3.com". Presne takto mám urobenú aj svoju doménu
  "deja-vix.sk".

  <li> Doména "virtualexample3.com" presmeruje v¹etku po¹tu pre akéhokoµvek
  pou¾ívateµa domény "@virtualexample3.com" na pou¾ívateµa
  "ja@virtualexample3.com". Z tejto adresy sa potom dá vybera» ako doménový
  kô¹ pomocou protokolov POP3 a IMAP a triedi» pre viacerých pou¾ívateµov
  napr. pomocou programu "<code><a
          href="http://catb.org/~esr/fetchmail/">fetchmail</a></code>". </ol>
  
  <p class="poznamka"><b>Poznámka:</b> aby fungovali virtuálne
  domény, musí by» Vá¹ server uvedený ako "MX" záznam pre tieto domény.</p>

  <p align="justify">Niekedy sa vy¾aduje, aby Postfix prijímal po¹tu pre
  doménu tak, ¾e nezále¾í na mene pred zavináèom (napr. "cokolvek@example.com"). Aj toto sa dá urobi» a to takto:
  </p>
  <dl>
      <dt> <b>luser_relay</b> = username</dt>
      <dt> <b>luser_relay</b> = username@example3.com</dt>
      <dd> urèuje meno pou¾ívateµa alebo e-mailovú adresu, na ktorú sa
      doruèuje po¹ta pre neexistujúcich pou¾ívateµov. To Vám umo¾ní odchytáva»
      po¹tu napr. pre "cokolvek@example.com" (ak je "example.com" Va¹a
      doména), aj keï neexistuje pou¾ívateµ ani alias "cokolvek".</dd>
  </dl>

  <p class="poznamka"><b>Poznámka:</b> aby presmerovanie fungovalo, musíte
  vypnú» kontrolu adresy príjemcu pomocou parametra <code>local_recipient_maps
      =</code></p>

  <p class="pozor"><b>Upozornenie:</b> pou¾itie tohto parametra rapídne zvý¹i
  výskyt SPAMu v tejto spoloènej schránke.</p>
  
  <a name="postfix_canonical"></a>
  <h5>6.2.5.2.7 "Pekné adresy" v tvare Meno.Priezvisko</h5>

  <p align="justify">
  Mo¾no ste u¾ videli mailové adresy v tvare "Meno.Priezvisko@example.com". Sú
  veµmi prí»a¾livé, v¹ak? A urèite ste zatú¾ili, aby aj va¹i pou¾ívatelia
  mohli pou¾íva» takéto jednoducho zapamätateµné adresy namiesto adries typu
  "login@example.com". (Ak máte napr. prihlasovacie mená na serveri vytvorené
  v tvare "prvé písmeno mena + maximálne 7 znakov priezviska", niekedy
  vznikajú celkom exotické kombinácie :))</p>

  <p align="justify">
  Ak teda va¹a tú¾ba po pekných mailových adresách prerastie v tú¾bu po
  realizácii v Postfixe, tu je postup, ako zabezpeèi» prepísanie
  pou¾ívateµského mena "vix" na "ivan.noris" (a opaène) a "pokus" na
  "peter.okus" (a opaène). Adresy sa prepí¹u v hlavièkách pri príjme aj
  odosielaní po¹ty, ak je doména zapísaná v $myorigin, $mydestination
  alebo $inet_interfaces.
</p>

  <dl>
      <dt> <b>canonical_maps</b> = hash:/etc/postfix/canonical</dt>
      <dd> urèuje umiestnenie databázy so zoznamom kanonických mien a ich
      transformácií</dd>
  </dl>

  <pre class="example">
/etc/postfix/canonical:
vix         ivan.noris
pokus       peter.okus

/etc/aliases:
ivan.noris:     vix
peter.okus:     pokus

<b>newaliases</b>
<b>postmap /etc/postfix/canonical
postfix reload</b>
</pre>

   <p class="poznamka">
   <b>Poznámka</b> Aby to celé fungovalo, musia pou¾ívatelia "vix" a "pokus" existova»
  a aliasy "ivan.noris" a "peter.okus" musíte definova» v súbore
  "<code>/etc/aliases</code>". Ak ich v aliasoch nedefinujete, odchádzajúca
  po¹ta bude ma» síce prepísané hlavièky, ale príjem na tieto adresy nebude
  fungova» v prípade, ¾e Postfix prijíma po¹tu len pre <b>lokálnych</b>
  pou¾ívateµov (parameter "local_recipient_maps").</p>

  <p class="pozor">
  <b>Upozornenie</b> Po zavedení mapovania "canonical" spôsobom, ako je tu
  uvedený, sa budú adresy pou¾ívateµov prepisova» pri prijímaní aj odosielaní
  po¹ty. V tomto prípade to znamená, ¾e pou¾ívateµ "vix" u¾ nedoká¾e odosla»
  e-mail tak, aby obsahoval adresu "vix@example.com"; v¾dy bude prepísaná na
  "ivan.noris@example.com". Tomu sa dá zabráni» pou¾itím jednosmerných
  prepisovacích máp. To bude predmetom ïal¹ích aktualizácií tejto príruèky.</p>
 
  <a name="postfix_main_restrictions"></a>
  <h5>6.2.5.2.8 Chcete nastavi» obmedzenia na príjem a posielanie po¹ty? Tieto Vám pomô¾u
      zbavi» sa èasti SPAMu.</h5>

  <dl>
      <dt> <b>local_recipient_maps</b> = $alias_maps unix:passwd.byname</dt>
      <dd> umo¾ní odmieta» prijímanie po¹ty pre pou¾ívateµov, ktorí neexistujú
      na Va¹om serveri e¹te poèas prijímania po¹ty (po¹ta sa vôbec neprijme,
      ani doèasne, a tak sa neskôr nebude generova» ïal¹í mail o nemo¾nosti
      doruèenia po¹ty). Táto direktíva urèuje tabuµku pou¾ívateµov
      (¹tandardne je to samozrejme súbor "<code>/etc/passwd</code>").
      <p class="pozor" align="justify">
      <b>Pozor!</b> Ak pou¾ijete tento parameter a slu¾ba SMTP pou¾íva <A HREF="#postfix_chroot">chroot()</A>
      nemusí ma» prístup k skutoènému súboru "<code>/etc/passwd</code>" - treba
      ho skopírova» do "<code>/var/spool/postfix/etc/passwd</code>" pri ka¾dej
      zmene! Najelegantnej¹ie to (na Debiane) urobíte pomocou konfiguraèných
      súborov programov "<code>adduser</code>" ("<code>adduser.local</code>")
      a "<code>deluser</code>" ("<code>deluser.local</code>").</p>
</dd>

     <dt> <b>disable_vrfy_command</b> = yes</dt>
     <dd> zaká¾e príkaz SMTP protokolu "VRFY" na zis»ovanie existencie
     mailovej schránky. Klient (alebo hackerský/spamerský nástroj) na druhej
     strane spojenia musí uskutoèni» normálny pokus o odoslanie mailu.</dd>

     <dt> <b>allow_untrusted_routing</b> = no</dt>
     <dd> zaká¾e smerovanie po¹ty zadané odosielateµom (odosielateµ mô¾e
     urèi», cez aký server sa bude posiela» po¹ta). Toto zastavuje niektoré
     SPAMy.</dd>

     <dt> <b>maps_rbl_domains</b> = relays.ordb.org, dnsbl.njabl.org, sbl-xbl.spamhaus.org</dt>
     <dd> zoznam pou¾itých RBL slu¾ieb. RBL (Real-Time Blackhole List)
     umo¾òuje Postfixu (aj iným slu¾bám) v <i>reálnom èase</i> zisti», èi je
     odosielateµ mailu uvedený v zozname známych ¹íriteµov SPAMu, alebo èi
     je jeho server "open relay" - teda server,
     cez ktorý mô¾e hocikto posiela» po¹tu hocikam. (Spomeòte si, ¾e na Va¹om
     Postfixe urèujete, kto mô¾e posiela» po¹tu cez Vá¹ server, pomocou parametra
     "<b>mynetworks</b>" a ¾e <i>takmer v¾dy</i> je to adresa Va¹ej lokálnej
     siete.)<br>
     Na základe RBL mo¾no urèité mno¾stvo SPAMu zachyti» e¹te
     pred prijatím mailu.<br>
     Uvedené nastavenie mi funguje u¾ niekoµko rokov a je na voµné pou¾itie.
     Existujú aj ïal¹ie RBL mapy, ale s tými nemám skúsenosti. <a
         href="http://www.declude.com/junkmail/support/ip4r.htm">Tu nájdete ich zoznam</a>.</dd>
     
     <dt> <b>smtpd_client_restrictions</b> = permit_mynetworks,
     reject_maps_rbl</dt>
     <dd> obmedzenia na adresy klientských poèítaèov, ktoré mô¾u vyu¾i» slu¾by
     Vá¹ho SMTP servera:
       <dl>
           <dt> permit_mynetworks</dt>
           <dd> povolí pripojenie z IP adries urèených premennou <b>$mynetworks</b>.
           Ak uvádzate toto pravidlo, uveïte ho ako prvé!</dd>

           <dt> reject_unknown_client</dt>
           <dd> zaká¾e pripojenie v prípade, ¾e klient nemá v DNS reverzný
           záznam. Toto je síce veµmi vhodné na odmietanie veµkého mno¾stva
           vírusov (èasto sa posielajú z poèítaèov, ktoré nemajú reverzný
           záznam), ale zároveò spoµahlivo odmietnete aj mno¾stvo regulérnej
           po¹ty zo serverov, ktoré nemajú reverzný záznam nastavený alebo
           ktoré ho nemajú nastavený správne. Pou¾ívajte opatrne!</dd>

           <dt> check_client_access typdb:databaza</dt>
           <dt> check_client_access hash:/etc/postfix/client_access</dt>
           <dd> skontroluje adresu klienta v databáze (súbore) daného typu
           (najèastej¹ie "hash" alebo "dbm") a zachová sa podµa pravidiel
           v nej. Najèastej¹ie pravidlo je "REJECT", teda odmietnutie po¹ty.
           V nov¹ích verziách Postfixu mô¾ete prida» aj text, ktorý sa zobrazí
           odosielateµovi ako dôvod odmietnutia po¹ty. (Mne to teda na Debiane
           Woody so ¹tandardným Postfixom e¹te ne¹lo, musel som pou¾i»
           konvenciu "550 Text") Ïal¹ie ¹tandardné
           pravidlo je "OK", teda prijatie po¹ty.
<pre class="example">
/etc/postfix/client_access:
192.168.67.89    REJECT
192.168.11.22    550 You are a spammer, go away!

<b>postmap client_access
postfix reload</b>
</pre>
           </dd>

           <dt> reject_maps_rbl</dt>
           <dd> zablokuje prístup v prípade, ¾e je adresa pozitívne
           identifikovaná zoznamom RBL.</dd>

           <dt> reject</dt>
           <dd> zaká¾e prístup. Pou¾ívajte na konci zoznamu pravidiel.</dd>

           <dt> permit</dt>
           <dd> povolí prístup. Pou¾ívajte na konci zoznamu pravidiel.</dd>
       </dl>
     </dd>

     <dt> <b>smtpd_helo_required</b> = yes</dt>
     <dd> klient musí pou¾i» SMTP príkaz "HELO" (èiastoène zabráni príjmu
     SPAMu, ale aj normálnych mailov od chybných mailových klientov, ktoré
     príkaz "HELO" neodosielajú)</dd>

     <dt> <b>smtpd_helo_restrictions</b> = permit_mynetworks, reject_invalid_hostname, reject_maps_rbl</dt>
     <dd> obmedzenia na syntax SMTP príkazu "HELO". Umo¾òuje zablokova»
     prijímanie mailu u¾ poèas prvej fázy SMTP spojenia, keï sa klient
     "predstavuje" Vá¹mu Postfixu. Tieto obmedzenia umo¾òujú odstráni» èas»
     SPAMu, ale tie¾ normálnej po¹ty, ktorá je zasielaná ne¹tandardným
     spôsobom.
     <dl>
           <dt> permit_mynetworks</dt>
           <dd> povolí pripojenie z IP adries urèených premennou <b>$mynetworks</b>.
           Ak uvádzate toto pravidlo, uveïte ho ako prvé!</dd>

           <dt> reject_invalid_hostname</dt>
           <dd> zablokuje pripojenie v prípade, ¾e klient pou¾il nesprávnu syntax príkazu HELO</dd>

           <dt> reject_unknown_hostname</dt>
           <dd> zablokuje pripojenie v prípade, ¾e poèítaè uvedený ako
           parameter príkazu "HELO" nemá v DNS záznam typu "A" alebo "MX". Toto
           umo¾òuje veµmi dobre filtrova» SPAM, preto¾e po¹ta sa <i>má
doruèova»</i> iba z po¹tových serverov a tie majú ma» jeden
           z týchto záznamov. Bohu¾iaµ, existuje mno¾stvo serverov,
           ktoré majú tento záznam nesprávny. Pou¾ívajte opatrne.</dd>

           <dt> reject_non_fqdn_hostname</dt>
           <dd> zablokuje pripojenie v prípade, ¾e poèítaè uvedený ako
           parameter príkazu "HELO" nie je uvedený v plnej doménovej forme
           (iba "host" namiesto "host.example.com")</dd>

           <dt> check_helo_access typdb:databaza</dt>
           <dt> check_helo_access hash:/etc/postfix/helo_access</dt>
           <dd> skontroluje adresu uvedenú ako parameter príkazu HELO
           v databáze (súbore) daného typu (najèastej¹ie "hash" alebo "dbm")
           a zachová sa podµa pravidiel v nej.
           Najèastej¹ie pravidlo je "REJECT", teda odmietnutie po¹ty.
           V nov¹ích verziách Postfixu mô¾ete prida» aj text, ktorý sa zobrazí
           odosielateµovi ako dôvod odmietnutia po¹ty. (Mne to teda na Debiane
           Woody so ¹tandardným Postfixom e¹te ne¹lo, musel som pou¾i»
           konvenciu "550 Text") Ïal¹ie ¹tandardné
           pravidlo je "OK", teda prijatie po¹ty.
<pre class="example">
/etc/postfix/helo_access:
192.168.67.89    REJECT
192.168.11.22    550 You are a spammer, go away!
<b>postmap helo_access
postfix reload</b>
</pre>
           </dd>
           
           <dt> reject</dt>
           <dd> zaká¾e prístup. Pou¾ívajte na konci zoznamu pravidiel.</dd>

           <dt> permit</dt>
           <dd> povolí prístup. Pou¾ívajte na konci zoznamu pravidiel.</dd>

     </dl>
     </dd>

     <dt> <b>smtpd_sender_restrictions</b> = reject_unknown_sender_domain,
     reject_maps_rbl, reject_non_fqdn_sender, check_sender_access hash:/etc/postfix/access</dt>
     <dd> obmedzenia na obsah príkazu SMTP "MAIL FROM". V tomto príkaze uvádza
     klient adresu odosielateµa po¹ty. Toto nastavenie mô¾e zastavi» SPAM od
     známych odosielateµov, pre kompletnej¹iu ochranu v¹ak potrebujete
     ¹pecializovaný program, napr. "<a href="#spamassassin_install"><code>SpamAssassin</code></a>".
     <dl>
           <dt> permit_mynetworks</dt>
           <dd> povolí pripojenie z IP adries urèených premennou <b>$mynetworks</b>.
           Ak uvádzate toto pravidlo, uveïte ho ako prvé!</dd>

           <dt> reject_unknown_sender_domain</dt>
           <dd> zaká¾e pripojenie v prípade, ¾e doména uvedená v "MAIL FROM" nemá v DNS záznam typu "A" alebo "MX".
           klient nemá v DNS reverzný záznam.</dd>

           <dt> reject_maps_rbl</dt>
           <dd> zablokuje prístup v prípade, ¾e je adresa pozitívne
           identifikovaná zoznamom RBL.</dd>

           <dt>check_sender_access typdb:databaza</dt>
           <dt> check_sender_access hash:/etc/postfix/access</dt>
         <dd> skontroluje adresu uvedenú ako parameter príkazu "MAIL FROM"
           v databáze (súbore) daného typu (najèastej¹ie "hash" alebo "dbm")
           a zachová sa podµa pravidiel v nej.
           Najèastej¹ie pravidlo je "REJECT", teda odmietnutie po¹ty.
           V nov¹ích verziách Postfixu mô¾ete prida» aj text, ktorý sa zobrazí
           odosielateµovi ako dôvod odmietnutia po¹ty. (Mne to teda na Debiane
           Woody so ¹tandardným Postfixom e¹te ne¹lo, musel som pou¾i»
           konvenciu "550 Text") Ïal¹ie ¹tandardné
           pravidlo je "OK", teda prijatie po¹ty.
<pre class="example">
/etc/postfix/_access:
bnn@inmail.sk           550 You are a spammer, go away
napalma@centrum.sk      550 You are a spammer, go away
igi_2@centrum.sk        550 You are a spammer, go away
igi2@szm.sk             550 You are a spammer, go away
cddb@inmail.sk          550 You are a spammer, go away
cddata@szm.com          550 You are a spammer, go away
this.is.spam.tld        550 This domain sends us only spam, go away!
<b>postmap /etc/postfix/access
postfix reload</b>
</pre>
        </dd>
        <dt> reject_non_fqdn_sender</dt>
        <dt> zablokuje prístup v prípade, ¾e mailová adresa odosielateµa
        v "MAIL FROM" nie je uvedená v plnom doménovom tvare.
        </dt>
           <dt> reject</dt>
           <dd> zaká¾e prístup. Pou¾ívajte na konci zoznamu pravidiel.</dd>

           <dt> permit</dt>
           <dd> povolí prístup. Pou¾ívajte na konci zoznamu pravidiel.</dd>

    </dl>
    </dd>

     <dt> <b>smtpd_recipient_restrictions</b> = permit_mynetworks,
     check_recipient_access pcre:/etc/postfix/recipient_checks,
        reject_unauth_destination</dt>
        <dd> obmedzenia na obsah príkazu SMTP "RCPT TO". V tomto príkaze
        uvádza klient adresu príjemcu po¹ty.<br>
        <p align="justify" class="pozor"><b>Pozor!</b> musíte uvies» aspoò jednu z hodnôt "reject",
        "check_relay_domains" alebo "reject_unauth_destination", inak Postfix
        nebude prijíma» po¹tu!</p>
        <dl>
           <dt> permit_mynetworks</dt>
           <dd> povolí pripojenie z IP adries urèených premennou <b>$mynetworks</b>.
           Ak uvádzate toto pravidlo, uveïte ho ako prvé!</dd>

            <dt>check_recipient_access typdb:databaza</dt>
            <dt>check_recipient_access hash:/etc/postfix/recipient_checks</dt>
            <dd>Toto obmedzenie mô¾ete s výhodou
            pou¾i» napríklad na limitovanie doruèovania po¹ty z Internetu pre
            niektorých pou¾ívateµov. Napríklad systémové kontá umo¾òujú príjem
            po¹ty, ktorá sa presmeruje na adresu správcu systému. Naèo má v¹ak
            pou¾ívateµ "nobody" prijíma» po¹tu z Internetu? Nemusí ju prijíma»
            vôbec!<br>
            <p align="justify" class="pozor"><b>Pozor!</b> ak pou¾ijete môj
            príklad, nepridávajte do zoznamu v¹etky systémové kontá alebo
            aliasy. Napríklad pou¾ívatelia "postmaster", "hostmaster" alebo
            "abuse" musia existova» a prijíma» po¹tu aj z Internetu!</p>
<pre class="example">
/etc/postfix/recipient_checks:
/^bin\@.*$/ 550 This user will not receive mail from Internet!
/^daemon\@.*$/ 550 This user will not receive mail from Internet!
/^sys\@.*$/ 550 This user will not receive mail from Internet!
/^games\@.*$/ 550 This user will not receive mail from Internet!
/^man\@.*$/ 550 This user will not receive mail from Internet!
/^lp\@.*$/ 550 This user will not receive mail from Internet!
/^mail\@.*$/ 550 This user will not receive mail from Internet!
/^news\@.*$/ 550 This user will not receive mail from Internet!
/^uucp\@.*$/ 550 This user will not receive mail from Internet!
/^proxy\@.*$/ 550 This user will not receive mail from Internet!
/^www-data\@.*$/ 550 This user will not receive mail from Internet!
/^nobody\@.*$/ 550 This user will not receive mail from Internet!

<b>postmap /etc/postfix/recipient_checks
postfix reload</b>
</pre>
          </dd>
          <dt>permit_mx_backup</dt>
          <dd> povolí prija» mail pre servery, ktoré uvádzajú Vá¹ mailový
          server ako mailový server (záznam typu "MX" v DNS). Tento parameter
          je urèený na to, aby mohol Vá¹ Postfix fungova» ako zálo¾ný mailový
          server pre tieto domény.
          <dt>reject_unauth_destination</dt>
          <dt>check_relay_domains</dt>
          <dd> povolí prija» mail:
          <ul>
              <li> na adresy urèené premennými $inet_interfaces,
              $mydestination alebo $virtual_maps (toto je doruèenie po¹ty NA
              mailový server)
              <li> z adries vyhovujúcich $relay_domains a ich subdomén
              kamkoµvek (týmto klientom poskytujete slu¾bu zasielania po¹ty
              cez Vá¹ mailový server smerom von)
              <li> z ostatných klientov na adresy uvedené v $relay_domains
              a ich subdomény (z Internetu mô¾u klienti cez tento mailový
              server posiela» pos»u iba smerom dnu)
          </ul>
          Uvedenie tohto parametra zároveò odmietne v¹etku ostatnú po¹tu.
          Uvádzajte toto pravidlo ako posledné v zozname
          "smtpd_recipient_restrictions"!<br>
          <p class="pozor" align="justify"><b>Pozor!</b>
          Podµa dokumentácie by ste v nov¹ích verziách Postfixu (po 20021202)
          mali pou¾íva» "reject_unauth_destination" namiesto
          "check_relay_domains"!!!</p></dd>
         </dl>
    </dd>

  </dl>
  <a name="postfix_main_size_limits"></a>
  <h5>6.2.5.2.9 Obmedzenia spracovania mailov (veµkosti, èasy)</h5>

<dl>
    <dt> <b>bounce_size_limit</b> = 50000</dt>
    <dd> maximálna veµkos» chybového mailu, ktorý sa vracia v prípade chyby.
    Zmen¹ením veµkosti zamedzíte prípadnému kolovaniu vírusov medzi Va¹ím
    a iným mailovým serverom.</dd>
    <dt> <b>header_size_limit</b> = 102400</dt>
    <dd> maximálna veµkos» v¹etkých hlavièiek mailu</dd>
    <dt> <b>line_length_limit</b> = 2048</dt>
    <dd> maximálna då¾ka riadku v maili</dd>
    <dt> <b>message_size_limit</b> = 4096000</dt>
    <dd> maximálna veµkos» spracovaného mailu (pri prijímani èi odosielaní)
    v bajtoch</dd>
    <dd> <b>mailbox_size_limit</b> = 51200000</dd>
    <dd> maximálna veµkos» po¹tovej schránky, s ktorou bude Postfix pracova».
    V skutoènosti je to maximálna veµkos» akéhokoµvek súboru pri zápise.
    <p align="justify" class="pozor"><b>Pozor!</b> Tento parameter nesmie by»
    men¹í ako hodnota <b>message_size_limit</b>!</p></dd>
    <dt> <b>queue_minfree</b> = 0</dt>
    <dd> minimálna veµkos» voµného miesta na disku. Ak klesne pod Vami zadanú
    hodnotu, Postfix prestane prijíma» po¹tu, aby e¹te viac nevyèerpal voµné
    miesto. To je veµmi vhodné v prípade, ¾e máte malý disk. Hodnota "0" túto kontrolu vypína.</dd>
    <dt> <b>delay_warning_time</b> = 4</dt>
    <dd> èas, po ktorom príde odosielateµovi upozornenie o nedoruèiteµnosti
    mailu. ©tandardne: 4 hodiny.</dd>
</dl>

  <a name="postfix_main_mda"></a>
  <h5>6.2.5.2.10 Ako sa doruèujú maily do pou¾ívateµských schránok? (Umiestnenie, formát
      a program, ktorý mail spracuje mô¾u by» rôzne.</h5>

  <dl>
      <dt> <b>mail_spool_directory</b> = /var/mail</dt>
      <dd> adresár s "klasickými" mailovými schránkami pou¾ívateµov (jedna
      schránka je jeden súbor, pre ka¾dého pou¾ívateµa jeden). Ak uvediete
      tento parameter, zvy¹né dva nepou¾ívajte!</dd>
      <dt> <b>home_mailbox</b> = Mailbox</dt>
      <dd> súbor "Mailbox" v domácom adresári pou¾ívateµa</dd>
      <dt> <b>home_mailbox</b> = Maildir/</dt>
      <dd> adresár "Maildir" v domácom adresári pou¾ívateµa. Bezpodmieneène
      treba uvies» znak "/" na konci mena adresára!!! Tento spôsob uchovávania
      mailov pou¾ívajú najmä: po¹tový server "qmail", IMAP/POP server "<a
          href="http://www.courier-mta.org">Courier IMAP</a>" a iné.</dd>
      <dt> <b>mailbox_command</b> = /usr/bin/procmail -a $DOMAIN -d $LOGNAME</dt>
      <dd> doruèovanie po¹ty pomocou programu "<code>procmail</code>"</dd>
      <dt> <b>mailbox_command</b> = /usr/bin/maildrop -d $USER</dt>
      <dd> doruèovanie po¹ty pomocou programu "<code>maildrop</code>". Tento
      program je súèas»ou balíka "<a
          href="http://www.courier-mta.org">Courier"</a> a ¹tandardne pou¾íva
      formát "Maildir" spomenutý v predchádzajúcich parametroch.</dd>
  </dl>

  <a name="postfix_main_virus_spam"></a>
  <h5>6.2.5.2.11 Vy¾adujete antivírovú a antispamovú kontrolu?</h5>
  
  <p align="justify">
  Pomocou Postfixu mô¾ete implementova» jednoduchý filter obsahu správ, ktorý
  Vám umo¾ní filtrova» mno¾stvo vírusov alebo SPAMu na základe rovnakého re»azca
  v mailoch.</p>
  
  <p class="poznamka"><b>Poznámka:</b> i keï je táto mo¾nos»
  veµmi príjemná, Postfix sám o sebe <b>nie je antivírus ani SPAM filter</b>,
  tak¾e jej mo¾nosti sú obmedzené. Pre skutoèné antivírové rie¹enie budete
  musie» prepoji» Postfix s niektorým z komerèných antivírusov (neviem zatiaµ
  o ¾iadnom spoµahlivom free rie¹ení). Ak potrebujete SPAMový filter, èítajte
  <a href="#spamassassin_install">ïalej</a>.</p>
  
  <dl>
      <dt> <b>header_checks</b> = pcre:/etc/postfix/body_checks</dt>
      <dd> súbor s regulárnymi výrazmi (formát Perl), ktoré sa majú kontrolova» v hlavièkách
      mailov za úèelom odmietania mailov. Aby toto fungovalo, musíte ma»
      nain¹talovaný aj balíèek "<code>postfix-pcre</code>"!</dd>
      <dt> <b>header_checks</b> = regexp:/etc/postfix/body_checks</dt>
      <dd> súbor s regulárnymi výrazmi (formát regexp), ktoré sa majú kontrolova» v hlavièkách
      <dt> <b>body_checks</b> = pcre:/etc/postfix/body_checks</dt>
      <dd> súbor s regulárnymi výrazmi (formát Perl), ktoré sa majú kontrolova» v telách
      mailov za úèelom odmietania mailov. Aby to fungovalo, musíte ma»
      nain¹talovaný aj balíèek "<code>postfix-pcre</code>"</dd>
      <dt> <b>body_checks</b> = regexp:/etc/postfix/body_checks</dt>
      <dd> súbor s regulárnymi výrazmi (formát regexp), ktoré sa majú kontrolova» v telách
  </dl>

  <p align="justify">Bli¾¹ie informácie spolu s príkladom nájdete <a
      href="#postfix_body_checks">neskôr</a>.</p>

<p class="poznamka">
<b>Poznámka:</b> nepreháòajte to s poètom filtrov. Veµké mno¾stvo výrazov
spôsobí spomalenie doruèovania mailov a vy¹¹iu spotrebu pamäte.</p>

  <a name="postfix_main_other"></a>
  <h5>6.2.5.2.12 Ostatné direktívy v konfiguraènom súbore</h5>

  <p align="justify">
  V konfiguraènom súbore "<code>/etc/postfix/main.cf</code>" sa samozrejme
  nachádza alebo mô¾e nachádza» oveµa väè¹ie mno¾stvo parametrov (kompletný
  zoznam aktuálnych nastavení spolu s defaultnými hodnotami získate zadaním
  príkazu "<code><b>/usr/sbin/postconf -v</b></code>"). Pre väè¹inu z nich
  platí: ak neviete, naèo daný parameter slú¾i, <b>nemeòte ho!</b>

  <dl>
      <dt> <b>queue_directory</b> = /var/spool/postfix</dt>
      <dd> adresár, v ktorom sa uchovávajú maily èakajúce na spracovanie
      (queue). Ak be¾ia démony Postfixu v <a
          href="#postfix_chroot">chroote</a>, je tento adresár pre ne
      koreòovým adresárom.</dd>

      <dt> <b>command_directory</b> = /usr/sbin</dt>
      <dd> umiestnenie programov dodávaných s Postfixom
      ("<code>post*</code>")</dd>

      <dt> <b>daemon_directory</b> = /usr/lib/postfix</dt>
      <dt> <b>program_directory</b> = /usr/lib/postfix</dt>
      <dd> adresár, v ktorých sa nachádzajú démony Postfixu</dd>

      <dt> <b>mail_owner</b> = postfix</dt>
      <dd> pou¾ívateµ, pod ktorým be¾í väè¹ina procesov súvisiacich
      s Postfixom a ktorý je vlastníkom èakajúcich mailov. Pri in¹talácii
      vytvorte na tento úèel ¹peciálneho pou¾ivateµa; balíèkové distribúcie
      vytvárajú pou¾ívateµa "postfix".</dd>

      <dt> <b>default_privs</b> = nobody</dt>
      <dd> pou¾ívateµ, ktorého práva sa ¹tandardne pou¾ijú pri lokálnom
      doruèovaní mailov.
      <p class="poznamka"><b>Poznámka:</b> Nepou¾ívajte
      pou¾ívateµa "postfix" ani "root".</p></dd>
      
      <dt> <b>smtpd_banner</b> = $myhostname ESMTP</dt>
      <dt> <b>smtpd_banner</b> = $myhostname ESMTP $mail_name</dt>
      <dt> <b>smtpd_banner</b> = $myhostname ESMTP $mail_name ($mail_version)</dt>
      <dt> text, ktorým sa ohlási Postfix, keï sa k nemu pripojí klient. Mo¾no
      budete chcie» ukry» meno po¹tového programu a jeho verziu. (Pamätajte,
      ¾e k bezpeènosti to veµmi neprispeje.)</dt>

      <dt> <b>maximal_queue_lifetime</b> = 5</dt>
      <dd> maximálny èas, poèas ktorého sa Postfix pokú¹a doruèi» mail
      (¹tandardná jednotka je deò (d), iné mo¾nosti: hodiny (h), minúty (m),
      sekundy (s), tý¾dne (w); default: 5 dní)</dd>

      <dt> <b>delay_warning_time</b> = 4</dt>
      <dd> èas, po ktorom príde odosielateµovi varovanie o nedoru¹iteµnosti
      mailu (default: 4 hodiny)</dd>

      <dt> <b>queue_run_delay</b> = 1000s</dt>
      <dd> interval na vyprázdòovanie mailového frontu (default: 1000 sekúnd)</dd>
</dl>

  <a name="postfix_complete_example"></a>
  <h4>6.2.5.3 Kompletný príklad konfiguraèného súboru</h4>

<pre class="example">
queue_directory = /var/spool/postfix
command_directory = /usr/sbin
daemon_directory = /usr/lib/postfix
program_directory = /usr/lib/postfix
mail_owner = postfix
default_privs = nobody

#myhostname = host.domain.name
#myhostname = virtual.domain.name

#mydomain = domain.name

myorigin = $myhostname
#myorigin = $mydomain

inet_interfaces = all
#inet_interfaces = $myhostname
#inet_interfaces = $myhostname, localhost

#mydestination = $myhostname, localhost.$mydomain
#mydestination = $myhostname, localhost.$mydomain $mydomain

mydestination = $myhostname, localhost.$mydomain,
	$mydomain,
	ns.$mydomain,
	mail.$mydomain, www.$mydomain

local_recipient_maps = $alias_maps unix:passwd.byname

double_bounce_sender = double-bounce

alias_maps  = hash:/etc/aliases
alias_database = hash:/etc/aliases

#home_mailbox = Mailbox
#home_mailbox = Maildir/
 
mail_spool_directory = /var/mail
#mail_spool_directory = /var/spool/mail

mailbox_command = /usr/bin/procmail -a $DOMAIN -d $LOGNAME

#header_checks = pcre:/etc/postfix/filename
#header_checks = regexp:/etc/postfix/filename

header_checks = pcre:/etc/postfix/body_checks
body_checks = pcre:/etc/postfix/body_checks

relay_domains = $mydestination

mynetworks = 10.0.0.0/24, 127.0.0.0/8

smtpd_banner = $myhostname ESMTP $mail_name
#smtpd_banner = $myhostname ESMTP $mail_name ($mail_version)
#smtpd_banner = $myhostname ESMTP $mail_name ($mail_version) (Linux-Mandrake)

local_destination_concurrency_limit = 2
default_destination_concurrency_limit = 10

debug_peer_level = 2

debugger_command =
	 PATH=/usr/bin:/usr/X11R6/bin
         xxgdb $daemon_directory/$process_name $process_id &amp; sleep 5

default_destination_recipient_limit = 25

initial_destination_concurrency = 2

maximal_backoff_time = 4000

maximal_queue_lifetime = 5

minimal_backoff_time = 1000

queue_run_delay = 1000

disable_vrfy_command = yes

smtpd_etrn_restrictions =

smtpd_recipient_limit = 1000

smtpd_timeout = 300

smtpd_error_sleep_time = 3

smtpd_soft_error_limit = 10

smtpd_hard_error_limit = 100

#smtpd_client_restrictions = permit_mynetworks, reject_unknown_client
#smtpd_client_restrictions = 
smtpd_client_restrictions = permit_mynetworks, reject_maps_rbl

smtpd_helo_required = yes

# smtpd_helo_restrictions = 
# smtpd_helo_restrictions = permit_mynetworks, reject_maps_rbl
smtpd_helo_restrictions = permit_mynetworks, reject_invalid_hostname

smtpd_sender_restrictions = reject_unknown_sender_domain,reject_maps_rbl,
    reject_non_fqdn_sender, check_sender_access hash:/etc/postfix/access
# smtpd_sender_restrictions = reject_unknown_sender_domain, hash:/etc/postfix/access
# smtpd_sender_restrictions = 

smtpd_recipient_restrictions = permit_mynetworks,
    check_recipient_access pcre:/etc/postfix/recipient_checks,
    reject_unauth_destination

allow_untrusted_routing = no

maps_rbl_domains = sbl.spamhaus.org, relays.ordb.org

access_map_reject_code = 550

invalid_hostname_reject_code = 501

maps_rbl_reject_code = 550

reject_code = 550

relay_domains_reject_code = 550

unknown_address_reject_code = 450

unknown_client_reject_code = 450

unknown_hostname_reject_code = 450

bounce_size_limit = 50000

command_time_limit = 1000

default_process_limit = 20

deliver_lock_attempts = 5

deliver_lock_delay = 1

duplicate_filter_limit = 1000

fork_attempts = 5

fork_delay = 1

header_size_limit = 102400

line_length_limit = 2048

message_size_limit = 4096000

mailbox_size_limit = 51200000

qmgr_message_active_limit = 1000

qmgr_message_recipient_limit = 1000

queue_minfree = 0

stale_lock_time = 500

transport_retry_time = 60

delay_warning_time = 4

allow_percent_hack = yes

append_at_myorigin = yes

#append_dot_mydomain = no
append_dot_mydomain = yes

empty_address_recipient = MAILER-DAEMON

masquerade_domains = $mydomain

masquerade_exceptions =

swap_bangpath = yes

trigger_timeout = 10
</pre>
  
  <A NAME="postfix_queue"></A>
  <H4>6.2.5.4 Nedoruèené maily a rie¹enie problémov</H4>

  <P ALIGN="justify">
  V prípade, ¾e chcete zisti», èi na serveri "nevisia" vo fronte nejaké
  (zatiaµ) nedoruèené alebo nedoruèiteµné maily, mô¾ete pou¾i» program
  "<code><b>mailq</b></code>", ktorý zobrazí zoznam týchto mailov spolu
  s identifikaènými re»azcami (napr. "D6F621FB89". Maily, ktoré sa Postfix práve
  sna¾í doruèi», sú oznaèené znakom "*".

  <P ALIGN="justify">
  V prípade, ¾e sa Postfixu nepodarí doruèi» mail a nejde o permanentnú chybu,
  pokúsi sa o doruèenie opä» o nejaký èas. Tento èas mô¾ete nastavi»
  parametrami "<b>delay_warning_time</b>", "<b>maximal_queue_lifetime</b>" a niekoµkými
  ïal¹ími, menej pou¾ívanými. V prípade, ¾e ste odstránili nejakú chybu
  a/alebo sa chcete pokúsi» o opätovné doruèenie "visiacich" mailov ruène,
  pou¾ite príkaz:</P>

  <pre class="example"><b>
  postfix flush
  </b></pre>

  <P ALIGN="justify">
  Ak sa rozhodnete odstráni» niektorý nedoruèiteµný mail zo záznamov Postfixu
  skôr, ako to urobí sám po nastavenom èase, mô¾ete pou¾i» program:</P>

  <pre class="example"><b>
  postsuper -d cislo_ziskane_vypisom_mailq
  </b></pre>

  <P ALIGN="justify">
  prípadne</P>

  <pre class="example"><b>
  postsuper -d -
  </b></pre>

  <P ALIGN="justify">
  a zadáva» identifikaèné re»azce na samostatné riadky (CTRL+D pre koniec).
  V nevyhnutnom prípade mô¾ete pou¾i» aj</P>

  <pre class="example"><b>
  postsuper -d ALL
  </b></pre>

  <P ALIGN="justify">
  na vymazanie V©ETKÝCH nedoruèených mailov vo fronte. Tento príkaz pou¾ívajte
  <i>veµmi</i> opatrne!!!

  <P ALIGN="justify">
  V prípade akýchkoµvek podozrení a problémov kontrolujte systémové logy.
  Postfix loguje do súborov "<code>/var/log/mail.log</code>" (prípadne do
  logov v adresári "<code>/var/log/mail</code>") a vie by» dostatoène ukecený,
  aby vám pomohol nájs» problém.

  <A NAME="postfix_body_checks"></A>
  <H4>6.2.5.5 Jednoduchá "ochrana proti vírusom"</H4>

  <P ALIGN="justify">
  Pred nejakým èasom som sa na Vazke rozhodol zabráni» masívnemu ¹íreniu
  vírusov/èervov skrytých v attachmentoch, ktoré sa v nemenovaných mailových
  klientoch spú¹»ajú automaticky, alebo po otvorení attachmentu dôverèivým
  pou¾ívateµom. Nie v¹etky poèítaèe toti¾ mali nain¹talovaný antivírový
  program a okrem toho som si chcel vyskú¹a» v "<code>postfixe</code>" nieèo
  nové. Podarilo sa - môj jednoduchý filter na attachmenty zaèal fungova»
  okam¾ite - ¾iaden mail s attachmentmi s príponami ".pif", ".exe", ".lnk"
  a pod. sa u¾ cez "<code>postfix</code>" nedal posla» (ani z jednej strany).
  Pre korektnos» uvádzam, ¾e regulárne výrazy pre filter som objavil (po dlhom
  hµadaní) na vyhµadávaèi <A HREF="http://www.google.com">Google</A>.

  <P ALIGN="justify">
  Rie¹enie je natoµko jednoduché, ¾e ho teraz ponúkam vám. Nie je to
  stopercentne úèinný antivírus, to v nijakom prípade. Ale na èervy a vírusy
  ¹íriace sa mailom, ktoré sa objavili poèas posledného roka to staèí. Ak
  niekto bude namieta», ¾e sa takýmto filtrom obmedzujú pou¾ívatelia servera,
  nech si vymyslí iné rie¹enie. Ja tvrdím, ¾e nikto nepotrebuje posiela»
  spú¹»ateµné súbory mailom. Jedinou výnimkou by mohli by» samorozbaµovacie
  archívy, tie sa v¹ak dajú premenova». Skrátka, je to na vás.

  <P ALIGN="justify">
  V¹etko, èo potrebujete, sú direktívy:</P>

  <pre class="example">
  header_checks = pcre:/etc/postfix/header_checks
  body_checks = pcre:/etc/postfix/body_checks
  </pre>

  "<b>header_checks</b>" urèuje výraz, ktorý sa má hµada» v hlavièke
  mailu, "<b>body_checks</b>" urèuje výraz, ktorý sa má hµada» v tele
  mailu (túto direktívu podporujú len verzie "<code>postfixu</code>" 20000528
  a vy¹¹ie, teda aj verzie 1.x a 2.x).
  
  <P ALIGN="justify">
  Súbor "<code>/etc/postfix/body_checks</code>" obsahuje regulárne výrazy
  (jeden na ka¾om riadku) v tvare:</P>

  <pre>/regularny vyraz/ REJECT text</pre>

  <P ALIGN="justify">
  Text "text" sa vlo¾í do chybového mailu, ktorý sa bude vraca»
  odosielateµovi. Prehµadávanie výrazov sa konèí, ak sa nájde vyhovujúci výraz
  alebo na konci súboru.

  <P ALIGN="justify">
  <b>Príklad:</b> ak by ste potrebovali odfiltrova» maily, ktoré obsahujú
  text: "Re: Your password" v hlavièke, potrebovali by ste regulárny výraz,
  ktorý by ste pridali do súboru "<code>/etc/postfix/header_checks</code>".

  <pre class="example">
  /^Subject:\s+Re: Your password/ REJECT Sorry, text in subject typical for Internet worm
  </pre>

  
  <P ALIGN="justify">
  Pre na¹e potreby sú súbory "<code>/etc/postfix/header_checks</code>"
  a "<code>/etc/postfix/body_checks</code>" rovnaké (skopírujte obsah,
  vytvorte si symlink alebo v oboch direktívach pou¾ite ten istý súbor
  "<code>/etc/postfix/body_checks</code>") a obsahujú tieto výrazy (skopírujte
  text <b>presne</b>, ide o tri dlh¹ie riadky alebo si ich <A
    HREF="export/body_checks.txt">ulo¾te ako súbor</A>):</P>

  <pre class="example">
/^begin \d\d\d .*\.(vbe|vbs|exe|com|jb|bat|pif|scr|lnk|cmd)/ REJECT Message content rejected; we do not accept executable attachments.
/^Content-(Disposition|Type)\:.*name="?.*\.(vbe|vbs|exe|com|jb|bat|pif|scr|lnk|cmd)"?/ REJECT Message content rejected; we do not accept executable attachments.
/^\s*(file)?name="?.*\.(vbe|vbs|exe|com|jb|bat|pif|scr|lnk|cmd)"?/ REJECT Message content rejected; we do not accept executable attachments.
/^Subject:.*your account/ REJECT Message content rejected; message has subject typical for viruses!
/The message cannot be represented in 7-bit ASCII encoding and has been sent as a binary attachment./ REJECT Message content rejected; found text typical for viruses.
/The message contains Unicode characters and has been sent as a binary attachment./ REJECT Message content rejected; found text typical for viruses.
/Mail transaction failed. Partial message is available./ REJECT Message content rejected; found text typical for viruses.
  </pre>

  <P ALIGN="justify">
  Aj bez znalostí regulárnych výrazov si viete doplni» ïal¹ie potrebné prípony
  alebo upravi» text, ktorý sa vlo¾í do chybového mailu zasielaného
  odosielateµovi potenciálne zavíreného mailu.
  
  <P ALIGN="justify">
  Teraz reloadnite konfiguráciu Postfixu:</P>
  
  <pre class="example"><b>/etc/init.d/postfix reload</b></pre>

  <P ALIGN="justify">
  a skúste si posla» mail s attachmentom s príponou, ktorá sa nachádza
  v na¹ich regulérnych výrazoch. Pre kontrolu si samozrejme skúste
  posla» aj mail s ne¹kodným attachmentom!

  <A NAME="postfix_master"></A>
  <H4>6.2.5.6 Konfiguraèný súbor démonov</H4>

  <P ALIGN="justify">
  Program "postfix" je rie¹ený ako súbor modulov, ktoré medzi sebou navzájom
  komunikujú a zasielajú si správy. V¹etky moduly be¾ia s právami pou¾ívateµa
  "<code>postfix</code>", èo výrazne zvy¹uje bezpeènos» celého systému. Iba
  hlavný proces "<code>master</code>" sa spú¹»a pod rootom a ovláda ostatné
  procesy. Sám v¹ak nepoèúva na nijakom porte a teda nie je dostupný zo siete.

  <P ALIGN="justify">
  Proces "<code>master</code>" spú¹»a ostatné procesy podµa potreby.
  Konfigurácia sa nachádza v súbore "<code>/etc/postfix/master.cf</code>" a je
  prednastavená tak, ¾e ak nechcete, nemusíte meni» vôbec niè. Tento
  konfiguraèný súbor v¹ak umo¾òuje pre procesy "<code>postfixu</code>"
  nastavi» napríklad spú¹»anie vo vyhradených adresároch (<A
  HREF="#postfix_chroot">chroot</A>), èo e¹te viac zvy¹uje bezpeènos» systému.

  <P ALIGN="justify">
  Uká¾ka konfiguraèného súboru "<code>/etc/postfix/master.cf</code>":</P>

  <pre class="example">
# ==========================================================================
# service type  private unpriv  chroot  wakeup  maxproc command + args
#               (yes)   (yes)   (yes)   (never) (50)
# ==========================================================================
smtp      inet  n       -       n       -       -       smtpd
pickup    fifo  n       n       n       60      1       pickup
cleanup   unix  -       -       n       -       0       cleanup
qmgr      fifo  n       -       n       300     1       qmgr
#qmgr     fifo  n       -       n       300     1       nqmgr
rewrite   unix  -       -       n       -       -       trivial-rewrite
bounce    unix  -       -       n       -       0       bounce
defer     unix  -       -       n       -       0       bounce
flush     unix  -       -       n       1000?   0       flush
smtp      unix  -       -       n       -       -       smtp
showq     unix  n       -       n       -       -       showq
error     unix  -       -       n       -       -       error
local     unix  -       n       n       -       -       local
virtual   unix  -       n       n       -       -       virtual
lmtp      unix  -       -       n       -       -       lmtp
cyrus     unix  -       n       n       -       -       pipe
    flags=R user=cyrus argv=/cyrus/bin/deliver -e -m ${extension} ${user}
uucp      unix  -       n       n       -       -       pipe
    flags=F user=uucp argv=uux -r -n -z -a$sender - $nexthop!rmail ($recipient)
ifmail    unix  -       n       n       -       -       pipe
    flags=F user=ftn argv=/usr/lib/ifmail/ifmail -r $nexthop ($recipient)
bsmtp     unix  -       n       n       -       -       pipe
    flags=F. user=foo argv=/usr/local/sbin/bsmtp -f $sender $nexthop $recipient
</pre>

  <P ALIGN="justify">
  Súbor obsahuje mno¾stvo komentárov, tak¾e ja budem len veµmi struèný. Význam
  pre nás dôle¾itých ståpcov v tabuµke:

  <UL>
  <LI> <b>service</b>: meno slu¾by. Pokiaµ nebudete zavádza» nejaké
  ¹peciality, nepotrebujete to.
  <LI> <b>transport type</b>: "inet" pre internetové (sie»ové) sokety, "unix"
  pre "unix" sokety, "fifo" pre pomenované rúry
  <LI> <b>unprivileged</b>: urèuje, èi slu¾ba be¾í s právami roota alebo
  pou¾ívateµa "postfix" (premenná "$mail_owner")
  <LI> <b>chroot</b>: urèuje, èi slu¾ba be¾í uzavretá vo vyhradenom adresári
  (chroot), ktorý urèuje premenná "$queue_directory". V¹etky postfixové slu¾by
  okrem "pipe" a "local" mô¾u be¾a» v chroote.
  </UL>

  
  <A NAME="postfix_chroot"></A>
  <H5>6.2.5.6.1 Chroot pre "<code>postfix</code>"</H5>
  
  <P ALIGN="justify">
  Na zvý¹enie bezpeènosti pomocou vyhradených adresárov staèí prepísa»
  "n" na "-" v ståpci "chroot" pre v¹etky slu¾by okrem "local" a tých, ktoré
  obsahujú v ståpci "command" príkaz "<code>pipe</code>" a re¹tartova»
  "<code>postfix</code>". Hneï skúste posla» niekoµko mailov z vá¹ho servera
  na vá¹ server, z vá¹ho servera na iný server a potom z iného servera na vá¹
  server. Ak nastal nejaký problém ("<code>postfix</code>" do systémových logov vynadá
  a prestane doruèova» po¹tu), skontrolujte, èi ste niekde neurobili chybu.
  
  <P ALIGN="justify" class="pozor">
  <b>Pozor!</b> Ak je v konfiguraènom súbore
  "<code>/etc/postfix/main.cf</code>" definovaná premenná
  "<code>local_recipient_maps = $alias_maps unix:passwd.byname</code>",
  "<code>postfix</code>" nemusí vedie» doruèova» po¹tu lokálnym pou¾ívateµom,
  preto¾e súbor "<code>/etc/passwd</code>" sa nachádza mimo vyhradeného
  adresára, ktorý pou¾ívajú jednotlivé slu¾by. Na túto skutoènos»
  "<code>postfix</code>" niekoµkonásobne a neobyèajne poeticky nadáva do
  logov. Rie¹enie je jednoduché: buï pre túto slu¾bu vypnite príznak "chroot",
  alebo pri ka¾dej zmene "<code>/etc/passwd</code>" (pridanie, zru¹enie
  pou¾ívateµa) musíte tento súbor skopírova» do adresára
  "<code>/var/spool/postfix/etc</code>".

  <A NAME="spam_definition"></A>
  <H2>6.3 SPAM - nevy¾iadaná po¹ta</H2>

  <P ALIGN="justify">
  Pravdepodobne ka¾dý z vás sa u¾ stretol s nevy¾iadanou po¹tou vo svojej
  schránke. Najväè¹ie mno¾stvo tejto po¹ty je v angliètine alebo japonèine
  (ktorú Mozilla seriózne zobrazuje :), ale v mojom mailboxe som objavil u¾ aj
  nevy¾iadané slovenské maily s èiste komerèným cieµom. Takéto maily sa
  oznaèujú ako SPAM alebo UCE (Unsolicited Commercial Email - Nevy¾iadaná
  obchodná elektronická po¹ta). V ïal¹om texte si dovolím pou¾íva» zau¾ívaný
  pojem "SPAM", aj keï sa tým mo¾no previním slovenskému jazykovému zákonu.
  Jednoducho to je krátke slovo - a hotovo!

  <P ALIGN="justify">
  Ka¾dému, kto dostáva pravidelne SPAM, vàtajú v hlave dve zásadné
  otázky:</P>

  <OL>
  <LI> <b>ako sa mi SPAM dostal do mailboxu?</b>
  <LI> <b>ako sa mô¾em bráni» proti SPAMu?</b>
  </OL>

  <A NAME="spam_getting"></A>
  <H3>6.3.1 Ako sa SPAM dostane do mailboxu?</H3>

  <P ALIGN="justify">
  SPAM sa do va¹ej schránky dostane najèastej¹ie preto, ¾e ste niekde na
  Internete uviedli svoju e-mailovú adresu. Mohlo sa to sta» pri registrácii
  na nejakej stránke - niektoré si vás automaticky zaradia do rôznych
  zoznamov, o ktorých neviete, èi nebudú poskytnuté tretím stranám. Ka¾dá
  stránka, na ktorej sa registrujete, by mala obsahova» informáciu o tom, ako
  bude nalo¾ené s údajmi, ktoré poskytnete - ak takýto údaj chýba, rozhodne
  nepou¾ívajte pri registrácii svoju oficiálnu mailovú adresu a vytvorte si na
  tento úèel jedno alebo niekoµko kont na freemailových serveroch.

  <P ALIGN="justify">
  Ja osobne sa sna¾ím nikde neregistrova», a ak u¾, tak sa riadim týmito
  pravidlami, a predsa sa mi v schránke objavujú SPAMy doruèené aj na
  oficiálne/pracovné adresy. Nedávno som zistil, ¾e to pravdepodobne spôsobil
  niektorý z Internetových èervov, ktoré posielajú náhodné maily náhodným
  príjemcom - takýmto spôsobom sa mô¾e ocitnú» adresa kohokoµvek z vás na
  akomkoµvek mieste na Zemi. Dokonca je vhodné, aby ste svoju adresu, ak ju
  vystavujete niekde na WWW stránkach, zapísali tak, aby nebola jednoducho
  identifikovateµná pre robotov, ktorí budú web prehµadáva». Napríklad moja
  adresa na konci ka¾dej z týchto stránok je uvedená ako "<code>vix (at)
  vazka.sk</code>". Existujú aj iné varianty, urèite sa s nimi na Internete
  stretnete.

  <P ALIGN="justify">
  Ïal¹ím spôsobom na získanie adries, ktoré sa potom potenciálne mô¾u pou¾i»
  na ¹írenie SPAMu sú re»azové maily typu "Chorý chlapec v Ugande dostane za
  ka¾dý email, ktorý forwardnete svojim priateµom 50 centov...", prípadne
  "Bill Gates sµúbil tým, èo po¹lú tento mail na 8000 adries 1 milión dolárov"
  a tak ïalej a¾ do omrzenia. <b>Absolútna väè¹ina</b> týchto mailov sú
  absolútne hlúposti, ktoré sú nereálne a vyu¾ívajú iba "sociálne
  in¾inierstvo" - jednoducho ho po¹lete ïalej, lebo "èo ak je to náhodou
  pravda?" Nie, nie je to pravda. Neexistuje spôsob, ako mô¾e poskytovateµ
  Internetu v USA zisti», ¾e ste posielali mail v rámci Slovenska, a u¾ vôbec
  nie komu a koµkokrát. Preto vás pekne prosím, aby ste skôr, ako zareagujete
  na re»azový mail, ráèili <b>v¾dy</b> skontrolova» stránku <A
  HREF="http://www.hoax.cz">www.hoax.cz</A>, kde sa doèítate o takmer v¹etkých
  re»azových mailoch, ktoré za»a¾ujú Internet.

  <p class="poznamka">
  <b>Poznámka trochu na okraj</b>: ak dostanete re»azový mail, ktorý vám oznamuje, ¾e
  máte vírus a nabáda vás, aby ste uskutoènili nejakú akciu na va¹om poèítaèi,
  <b>najprv porozmý¹µajte</b> a potom <b>skontrolujte stránky renomovaných
  antivírusových dodávateµov</b>, ktorí oznamujú aj falo¹né poplachy (fámy)
  ¹íriace sa v mailoch. Na Slovensku mô¾ete vyskú¹a» minimálne <A
    HREF="http://www.eset.sk">www.eset.sk (antivírus NOD)</A>, <A
    HREF="http://www.avg.cz/">www.avg.cz (antivírus AVG)</A> prípadne <A
    HREF="http://www.symantec.com">www.symantec.com (Norton Antivirus)</A></P>

  <P ALIGN="justify">
  <U>Odporúèania:</U>

  <OL>
  <LI> nepou¾ívajte pri registrácii na stránkach svoju normálnu (napr. firemnú) e-mailovú
  adresu - vytvorte si jednu práve na takéto úèely a raz za èas ju
  skontrolujte a vyprázdnite
  <LI> dôkladne si preèítajte, ako bude prevádzkovateµ danej stránky naklada»
  s va¹imi údajmi - menovite e-mailovou adresou
  <LI> pred odoslaním registrácie sa presvedète, ¾e nie je vybraná voµba typu
  "<I>chcem dostáva» pravidelné e-maily o ...</I>" - takáto voµba býva èasto
  <b>¹tandardne predvolená!</b>
  <LI> ne¹írte zjavné re»azové maily (kontrolujte na <A
  HREF="http://www.hoax.cz">www.hoax.cz</A>)
  <LI> neverte v¹etkému, èo èítate o vírusoch vo va¹ej po¹te (kontrolujte na
  stránkach antivírusových dodávateµov)
  </OL>

  <A NAME="spam_detect"></A>
  <H3>6.3.2 Detekcia a filtrovanie SPAMov</H3>

  <P ALIGN="justify">
  V¹etko spomenuté metódy, ako sa bráni» pred SPAMom nemusia pomôc»
  stopercentne a podµa Murphyho zákonov ani nepomô¾u. Ide toti¾ skôr
  o prevenciu a my potrebujeme rie¹i» u¾ existujúci problém. Rie¹enie je
  "jednoduché" - program na detekciu a prípadné filtrovanie SPAMov.

  <P ALIGN="justify">
  Na prvý pohµad sa mô¾e zda», ¾e vytvori» takýto program je veµmi »a¾ké. Ak
  sa v¹ak bli¾¹ie pozriete na typické SPAMy, opakujú sa v nich rovnaké vety,
  slová, výrazy... (napr. "WIN $1.000.000 NOW!" a podobne). Programy na detekciu
  SPAMu vedia takéto (a mnohé iné!) výrazy vyhµada» a na základe nich mail
  buï oznaèia za SPAM alebo nie...

  <P ALIGN="justify">
  <b>Stop!</b>

  <P ALIGN="justify">
  Zdá sa vám to jednoduché? Naozaj, SPAM nie je A® zasa také »a¾ké detekova»,
  ale èo ak program na detekciu SPAMu oznaèí za SPAM aj celkom normálnu po¹tu,
  ktorá náhodou obsahuje re»azce typické pre SPAM?

  <P ALIGN="justify">
  Progam, o ktorom budeme hovori» - <A
    HREF="http://spamassassin.org"><code>SpamAssassin</code></A> pou¾íva na oznaèovanie
  mailov techniku priraïovania bodov. Ka¾dá podozrivá hlavièka alebo ka¾dý
  podozrivý výraz v maili spôsobia zvý¹enie celkového skóre. Naopak, texty
  typické pre normálnu komunikáciu skóre zni¾ujú.

  <P ALIGN="justify">
  Niektoré typické testy na SPAM sú:</P>

  <UL>
    <LI> detekcia falo¹ných hlavièiek (falo¹ný odosielateµ, falo¹ná identifikácia
  mailového klienta)

  <LI> "náhodne" vyzerajúca adresa odosielateµa (napr. "<code>th6u7bft589rt@yahoo.com</code>")

  <LI> fráza súvisiaca s èastou nevy¾iadanou po¹tou (napr. "XXX", "$$$", "click
  here", "Viagra" a podobne)

  <LI> CELÉ RIADKY NAPÍSANÉ VE¥KÝMI PÍSMENAMI

  <LI> maily obsahujúce iba HTML
  </UL>
  
  <P ALIGN="justify">
  a mnohé iné!

  <P ALIGN="justify">
  Program je schopný vyu¾i» aj niektoré ïal¹ie techniky na detekciu SPAMu, napr.:</P>
  
  <UL>
    <LI> overovanie IP adresy odosielateµa v zozname tzv. "otvorených relay
    serverov" (serverov, ktoré umo¾òujú posiela» mail komukoµvek a kamkoµvek,
    nielen pre domény, ktoré obsluhujú).
    <LI> overovanie IP adresy odosielateµa v zozname "dial-upových
    pou¾ívateµov". V pozadí tohto testu je my¹lienka, ¾e ak pou¾ívate dial-up,
    máte pou¾íva» mailové server svojho providera a nie posiela» maily zo
    svojej dynamickej adresy.
    <LI> overovanie e-mailovej adresy odosielateµa v databáze overených
    odosielateµov SPAMu.
  </UL> 
  
  <P ALIGN="justify">
  (Na tieto ¹pecialitky budete potrebova» prídavné perlovské moduly.)

  <P ALIGN="justify">
  V konfigurácii programu je nastavený prahový limit a keï e-mail
  tento limit prekroèí, je automaticky oznaèený za SPAM.
  <code>SpamAssassin</code> sa poèas svojho ¾ivota aj uèí - ak pravidelne
  dostávate maily od konkrétneho odosielateµa s nízkym skóre, oznaèí si ho
  v databáze a pre ka¾dý ïal¹í mail od tohto odosielateµa odpoèítava nejakú
  hodnotu od výsledného skóre. Opaène to funguje pre SPAM.
  
  <P ALIGN="justify"> Funkciu "samouèenia sa" mô¾ete vyu¾i» aj manuálne, ak
  máte zbierku SPAMov, ktoré ste dostali e¹te pred pou¾ívaním programu alebo
  ktoré <code>SpamAssassin</code> nezachytil. a chcete na nej
  <code>SpamAssassin</code> natrénova». V takom prípade si pozrite
  dokumentáciu k "<code><b>sa-learn</b></code>" (príkazom "<code>man</code>"
  alebo "<code>perldoc</code>")

  <P ALIGN="justify">
  V prípade programu <code>SpamAssassin</code> sa nevykonáva nijaká
  de¹truktívna akcia. Do mailu sa pridá ¹peciálna hlavièka
  "<code>X-Spam-Status</code>" s hodnotou "no", ak ide o be¾ný mail, alebo
  "yes", ak ide o SPAM. Na základe hlavièky "<code>X-Spam-Status: yes</code>"
  mô¾ete teda maily neskôr triedi» alebo vymazáva».

  <P ALIGN="justify">
  Okrem toho vkladá <code>SpamAssassin</code> do ka¾dého SPAMu aj informácie
  o tom, preèo ho oznaèil za SPAM, èo vám mô¾e pomôc» pri jednoduch¹ej
  identifikácii podobných mailov. V nov¹ej verzii (2.50) sa tieto informácie
  vkladajú ako samostatná príloha, tak¾e sa nepo¹kodí vzhµad pôvodného
  mailu, ako to bolo v star¹ích verziách. Ak si to ¾eláte, mô¾e
  "<code>SpamAssassin</code>" oznaèova» SPAM aj pomocou subjectu "<code><b>****SPAM****</b></code>" (táto mo¾nos» sa dá vypnú» a dokonca
  v nov¹ích verziách je ¹tandardne vypnutá) a normálne sa doruèia.

  <P ALIGN="justify">
  Maily identifikované ako SPAM mô¾ete teda maza» alebo presúva» ruène,
  filtrova» ich na úrovni mail servera, alebo pomocou nastavenia filtrovania
  vo Va¹om e-mailovom klientovi (Mozilla Mail, Evolution, Eudora, ...).
  Najelegantnej¹ie je pou¾itie SpamAssassin-a priamo vo Va¹om programe na
  doruèovanie po¹ty na serveri ("<code>procmail</code>",
  "<code>maildrop</code>", ...) na základe hodnoty hlavièky
  "<code>X-Spam-Status: yes</code>".

  <P ALIGN="justify">
  Moje praktické skúsenosti (pou¾ívame <code>SpamAssassin</code> v práci
  zhruba od mája 2002) ukázali, ¾e detekèné schopnosti programu sú skutoène
  veµmi dobré, <code>SpamAssassin</code> detekoval takmer ka¾dý SPAM v mojom
  mailboxe, prièom falo¹né poplachy (normálny mail oznaèený ako SPAM)
  spôsobuje iba v niekoµkých percentách prípadov. Pri desiatkach a¾ stovkách
  mailov denne v mojich mailboxoch je to zhruba 1 mail tý¾denne - v¾dy od toho
  istého odosielateµa, ktorý pou¾íva divný webmail s podozrivo dlhými
  (nezalamovanými) riadkami a pravidelne pí¹e maily bez uvedenia subjectu.

  <P ALIGN="justify"><b>Program "<code>SpamAssassin</code>":</b>

  <UL>
    <LI> <b>detekuje a oznaèuje SPAM s veµkou percentuálnou úspe¹nos»ou (viac
    ako 90%)</b>
    <LI> <b>nevykonáva s mailami nijaké akcie okrem oznaèovania (nema¾e,
  nepresúva)</b>
    <LI> <b>funguje ako filter, musíte ho teda vola» z programu, ktorý fyzicky
      doruèuje po¹tu do Vá¹ho mailboxu ("<code>procmail</code>",
      "<code>maildrop</code>", ...)</b>
</UL>

  <A NAME="spamassassin_install"></A>
  <H3>6.3.3 In¹talácia programu SpamAssassin</H3>

  <P ALIGN="justify">
  Postup pre in¹taláciu samotného programu a v¹etkých modulov jazyka Perl,
  ktoré pre svoju èinnos» potrebuje alebo odporúèa, nájdete priamo
  v dokumentácii (súbor "<code>INSTALL</code>", aj èas» "Additional Modules").
  Ak chcete, mô¾ete si stiahnu» aj balíèek, èi u¾ z <A
    HREF="http://spamassassin.org">domácej stránky projektu</A> alebo
z archívov distribúcie <A HREF="http://www.debian.org">Debian</A> (<code><b>apt-get
        install spamassassin</b></code>) - na Debiane to vyrie¹i aj v¹etky
závislosti. V prípade manuálnej in¹talácie nejde vïaka
  závislostiam na perlovských moduloch (s»ahujte ich pomocou návodu uvedeného
  v súbore "<code>INSTALL</code>" alebo ruène z archívu <A
    HREF="http://www.cpan.org/">www.cpan.org</A>) o triviálnu in¹taláciu, ale
  pomocou manuálu a veµkej dávky trpezlivosti sa Vám to urèite podarí.

  <P ALIGN="justify">
  <b>Krátky návod ako in¹talova» perlovské moduly (napr. pre
  "<code>SpamAssassin</code>"):</b>

  <OL>
    <LI> preèítajte si v súbore "<code>INSTALL</code>" zoznam modulov, ktoré
    budete potrebova». Niektoré sú súèas»ou ¹tandardnej distribúcie Perlu (v
    súbore "<code>INSTALL</code>" Vás na to upozornia poznámky)
    <LI> skontrolujte, ktoré z po¾adovaných modulov u¾ máte nain¹talované, napr.
    príkazom na zobrazenie ich dokumentácie (príkaz "perldoc" nesmiete spú¹»a»
    ako root, nepôjde to):

    <pre class="example"><b>
    perldoc File::Spec
    perldoc HTML::Parser
    ...
    </b></pre>

    
    <LI> moduly, ktoré nemáte nain¹talované, stiahnite zo stránky <A
      HREF="http://www.cpan.org/">www.cpan.org</A> napr. do adresára
    "<code>/var/tmp</code>". Rozbaµte moduly a preèítajte si súbor
    "<code>README</code>" resp. "<code>INSTALL</code>", aby ste zistili, aké
    na akých ïal¹ích moduloch závisia. Stiahnite aj tieto moduly. 
    <LI> in¹taláciu modulov (zaènite tými, ktoré nezávisia na ïal¹ích moduloch)
    uskutoèníte príkazmi ("xxx" predstavuje adresár s rozbaleným modulom):
    <pre class="example"><b>
    cd /var/tmp/xxx
    perl Makefile.PL
    make
    make test
    make install
</b></pre>
("<b><code>make install</code></b>" musíte vykona» ako root).
    <LI> ak sa in¹talácia nepodarila (zobrazia sa chyby o tom, ¾e po¾adované
    moduly neboli nájdené), skontrolujte e¹te raz, ktoré moduly ste u¾
    nain¹talovali a doin¹talujte potrebné moduly!
    <LI> celkom na záver vojdite do adresára s rozbaleným archívom programu
    "<code>SpamAssassin</code>" a zopakujte hore uvedené kroky (sú uvedené aj v súbore
    "<code>INSTALL</code>")

    <pre class="example"><b>
    cd /var/tmp/Mail-SpamAssassin-2.50
    perl Makefile.PL
    make
    make test
    make install
</b></pre>
    <LI> po úspe¹nej in¹talácii mô¾ete vymaza» adresáre s rozbalenými a u¾
    nain¹talovanými modulmi. Adresár so samotným programom
    <code>"SpamAssassin</code>" si zatiaµ ponechajte!
  </OL>

  <P ALIGN="justify">
  Predpokladajme, ¾e <code>SpamAssassin</code> máte nain¹talovaný (napr.
  v adresári "<code>/usr/local/bin</code>"). Nasleduje veµmi dôle¾itý krok:
  otestovanie funkènosti! Presne ako odporúèajú autori
  v "<code>INSTALL</code>", <I>zadajte v adresári so zdrojovými textami
programu</I> (ak ste in¹talovali balíèek na Debiane, v adresári
  "<code>/usr/share/doc/spamassassin</code>", kde zároveò rozbaµte zbalené súbory
  "<code>sample-nonspam.txt.gz</code>" a "<code>sample-spam.txt.gz</code>"):</P>

  <pre class="example"><b>
  spamassassin -t &lt; sample-nonspam.txt &gt; nonspam.out
  spamassassin -t &lt; sample-spam.txt &gt; spam.out
  </b></pre>

  <P ALIGN="justify">
  Súbory "<code>sample-nonspam.txt</code>" a "<code>sample-spam.txt</code>"
  obsahujú skutoèné e-mailové správy, z ktorých prvá nie je a druhá je SPAM.
  Mô¾ete si ich najprv vypísa», aby ste mi uverili. Dôle¾ité je, ¾e sú to
  pokusné e-maily, na ktorých otestujeme, èi <code>SpamAssassin</code> funguje
  tak, ako by mal, t.j. èi nepadá, nevypisuje chyby a pod.

  <P ALIGN="justify">
  Pomocou textového editora alebo programov "<code>less</code>" èi
  "<code>more</code>" si vypí¹te novovytvorené súbory
  "<code>nonspam.out</code>" a "<code>spam.out</code>".
  "<code>nonspam.out</code>" by sa mal javi» ako normálny mail (s hlavièkami),
  súbor "<code>spam.out</code>" by mal v subjecte obsahova» text
  "<code>****SPAM****</code>" a identifikáciu SPAMu. Oba príkazy nesmú
  zobrazi» nijaké chyby pri spú¹»aní! V prípade, ¾e vynecháte tieto testy,
  mô¾e sta», ¾e sa Vám nebude doruèova» po¹ta!
  
  <A NAME="spamassassin_procmail"></A>
  <H3>6.3.4 Prepojenie programu SpamAssassin s programom na doruèovanie po¹ty</H3>

  <P ALIGN="justify">
  Ak predchádzajúce testy dopadli dobre, je èas nasadi» <code>SpamAssassin</code> do
  reálneho ¾ivota. Pomô¾e nám pri tom program, ktorý fyzicky doruèuje po¹tu
  jednotlivým pou¾ívateµom do ich mailboxov. Tento program je vo väè¹ine
  in¹talácií ¹tandardne "<code>procmail</code>" - ak pou¾ívate "Postfix",
  mô¾ete sa o tom presvedèi» kontrolou premennej
  "<code>mailbox_command</code>" v konfiguraènom súbore
  "<code>/etc/postfix/main.cf</code>". U nás v práci pou¾ívame na doruèovanie
  mailov program "<code>maildrop</code>", ktorý pracuje s formátom Maildir.
  Tento program si mô¾ete stiahnu» na stránke <A
    HREF="http://www.courier-mta.org/">www.courier-mta.org</A>, kde nájdete aj
  IMAP server "Courier".

  <P ALIGN="justify">
  <b>Upozornenie!</b> Pri testovaní a konfigurovaní akéhokoµvek filtra (a teda
  aj programu "<code>SpamAssassin</code>") sledujte logy Vá¹ho mailového
  servera ("<code>/var/log/mail.log</code>") a hµadajte anomálie. Ak sa
  mailovému serveru nepodarí doruèi» po¹tu (programy "<code>procmail</code>"
  resp. "<code>maildrop</code>" zlyhajú), ponecháva si ju stále vo fronte
  mailov, zaloguje v¹ak chybové hlásenie s dôvodom chyby. Najèastej¹ie je to
  chybná cesta/meno súboru.

  <A NAME="spamassassin_procmail_example"></A>
  <H4>6.3.4.1 SpamAssassin a Procmail</H4>

  <P ALIGN="justify">
  Program "<code>procmail</code>" pri doruèovaní po¹ty konkrétnemu
  pou¾ívateµovi hµadá súbor "<code>.procmailrc</code>" v jeho domácom
  adresári. V prípade, ¾e ho nájde, riadi sa jeho pravidlami, èo umo¾òuje
  napr. triedi» si po¹tu do prieèinkov u¾ na serveri (nie v e-mailovom
  klientovi!), automaticky forwardova» po¹tu na iné adresy, alebo robi»
  s mailami rôzne psie kusy. Presne takto pou¾ijeme teraz ná¹ program
  SpamAssassin.

  <P ALIGN="justify">
  Pomocou textového editora otvorte (alebo vytvorte) súbor
  "<code>.procmailrc</code>" vo va¹om domácom adresári a na jeho
  <b>zaèiatok</b> (aby sa toto pravidlo vykonalo ako prvé bez ohµadu na to, èo
  budete neskôr s po¹tou robi») vlo¾te toto:</P>

  <pre class="example">
  :0fw
  * &lt; 256000
  | /usr/local/bin/spamassassin
  </pre>

  <P ALIGN="justify">
  Uvedené pravidlo spôsobí automatické filtrovanie ka¾dého prijatého mailu,
  ktorý je men¹í ako cca 256 KB cez program <code>SpamAssassin</code> (zadajte
  cestu platnú pre va¹u in¹taláciu!). Limit veµkosti má význam preto, ¾e mail
  so SPAMom zvyèajne nebýva taký veµký a kontrola veµkých mailov trvá
  pochopiteµne dlh¹ie.

  <P ALIGN="justify">
  Ulo¾te súbor "<code>.procmailrc</code>" a skúste si posla» mail. Ideálne je,
  ak si po¹lete jeden normálny mail a potom súbor
  "<code>sample-spam.txt</code>", aby ste sa presvedèili, ¾e v poli "Subject:"
  je zreteµné oznaèenie "<code>****SPAM****</code>"

  <p class="poznamka">
  <b>Poznámka</b>: pri prvom spustení programu <code>SpamAssassin</code> (èi¾e
  pri doruèení prvého mailu) sa pou¾ívateµovi vytvorí adresár
  "<code>.spamassassin</code>" v domácom adresári s konfiguraènými súbormi,
  ktoré si mô¾e upravi» podµa svojho gusta. Ja osobne som ich upravova» zatiaµ
  nepotreboval.

  <p class="poznamka">
  <b>Poznámka</b>: <I>ak v¹etko funguje</I>, mô¾ete vytvori» globálne pravidlo, ktoré
  urobí presne to isté, ako sme si ukázali, ale pre v¹etkých pou¾ívateµov na
  serveri. Postupujte podobne, ale pou¾ite/vytvorte súbor
  "<code>/etc/procmailrc</code>". Nezostáva mi niè iné, ako vás dôrazne
  varova», aby ste k tomuto kroku pristúpili a¾ nále¾itom otestovaní!
  Pamätajte tie¾ na to, ¾e toto rie¹enie je pomerne neefektívne a neumo¾òuje
  pou¾i» "SpamAssassin" na mailových serveroch, ktoré nedoruèujú po¹tu do
  lokálnach schránok, ale ju len preposielajú napr. medzi dvomi sie»ami
  (relay).</p>

  <p align="justify">Ja pou¾ívam "<code>/etc/procmailrc</code>" v takejto
  podobe:</p>

  <pre class="example">
  <b>DROPPRIVS=yes</b>
  MAILDIR=$HOME/mail

  :0fw: spamassassin.lock
  * &lt; 256000
  | /usr/local/bin/spamassassin
  </pre>


  <P ALIGN="justify">
  Uvedené pravidlo "<code>| /usr/local/bin/spamassassin</code>"
  "<code>.procmailrc</code>" resp. "<code>/etc/procmailrc</code>" zabezpeèuje
  iba oznaèovanie mailov, ako som spomínal v úvode. Ak chcete s oznaèenou
  po¹tou urobi» nieèo iné, musíte si na¹tudova» manuál k programu
  "<code>procmail</code>" ("<code><b>man procmailrc</b></code>", "<code><b>man
          procmailex</b></code>"), preèíta» súbor
  "<code>procmail.example</code>" v adresári so zdrojovými kódmi programu
  <code>SpamAssassin</code>, alebo - poèka», kým sa v tejto príruèke stihnem
  vyjadri» aj k samotnému "<code>procmailu</code>".</p>

  <p class="pozor"><b>Upozornenie</b>: v globálnom konfiguraènom súbore
  "<code>/etc/procmailrc</code>" sa musí nachádza» direktíva
  "<code>DROPPRIVS=yes</code>"! Pomocou nej zaruèíte, ¾e v¹etky príkazy
  spú¹»ané z "<code>procmail</code>" sa spustia s právami pou¾ívateµa, ktorému
  sa doruèuje mail. Bez tejto direktívy sa <code>SpamAssassin</code>
  nespustí.</p>


  <A NAME="spamassassin_maildrop_example"></A>
  <H4>6.3.4.2 SpamAssassin a Maildrop</H4>

  <P ALIGN="justify">
  Program "<code>maildrop</code>" pri doruèovaní po¹ty kontroluje, èi existuje
  súbor "<code>.mailfilter</code>" v domácom adresári pou¾ívateµa, ktorému
  doruèuje po¹tu. V prípade, ¾e ho nájde, riadi sa pravidlami uvedenými
  v tomto súbore.

  <P ALIGN="justify">
  Pomocou textového editora otvorte (alebo vytvorte) súbor
  "<code>.mailfilter</code>" vo Va¹om domácom adresári a na jeho
  <b>zaèiatok</b> (aby sa toto pravidlo vykonalo ako prvé) vlo¾te riadok:</P>

  <pre class="example">
  xfilter "/usr/local/bin/spamassassin"
  </pre>

  <P ALIGN="justify">
  Samozrejme, musíte uvies» platnú cestu k programu "<code>spamassassin</code>". Teraz
  ulo¾te súbor "<code>.mailfilter</code>" a skúste si posla» mailom súbory
  "<code>sample-spam.txt</code>" a "<code>sample-nonspam.txt</code>" z distribúcie programu
  "<code>SpamAssassin</code>" (alebo akékoµvek maily). Ak sa Vám doruèia, filtrovanie
  funguje, navy¹e by mail so SPAMom mal by» oznaèený.
  
  <p class="poznamka">
  <b>Poznámka</b>: pri prvom spustení programu <code>SpamAssassin</code> (èi¾e
  pri doruèení prvého mailu) sa pou¾ívateµovi vytvorí adresár
  "<code>.spamassassin</code>" v domácom adresári s konfiguraènými súbormi,
  ktoré si mô¾e upravi» podµa svojho gusta. Ja osobne som ich upravova» zatiaµ
  nepotreboval.

  <A NAME="spamassassin_optimize"></A>
  <H3>6.3.5 Optimalizácia výkonu programu SpamAssassin</H3>

  <P ALIGN="justify">
  Program "<code>SpamAssassin</code>" je napísaný v Perle, v èom spoèíva veµká
  výhoda
  - netreba ho kompilova», je µahko prenosný a relatívne bezpeèný, preto¾e
    v Perle je bezpeènos» prideµovania voµnej pamäte rie¹ená lep¹ie ako
    v jazyku C. Na druhej strane, Perl je interpretovaný kód, resp. pri jeho
    spustení sa vykonáva jeho preklad, èo spôsobuje isté spomalenie. Ak
    sa filtrovanie mailov vykonáva na serveri, ktorý prijíma veµa po¹ty, bude
    sa interpreter Perlu spú¹»a» v podstate stále (zaka¾dým, keï sa má mail
    doruèi» do mailboxu).

  <P ALIGN="justify">
  Je jasné, ¾e výkon takéhoto rie¹enia nie je celkom optimálny. Pre malý poèet
  pou¾ívateµov, ktorí pou¾ívajú "<code>SpamAssassin</code>" to nepredstavuje
  nejaký záva¾ný problém, ale v prípade väè¹ej organizácie, kde sa maily
  filtrujú globálne, sa to u¾ na výkone servera prejaví.

  <P ALIGN="justify">
  Rie¹enie je v¹ak (na¹»astie) jednoduché. Program "<code>SpamAssassin</code>"
  obsahuje toti¾ okrem perlovského skriptu aj klient-server verziu. Démon
  "<code>spamd</code>" je napísaný v Perle, spú¹»a sa v¹ak iba raz, pri ¹tarte
  systému (vytvára nový proces pre ka¾dý filtrovaný mail). Démon poèúva na
  localhoste na porte 783 (mo¾no ho zmeni») a ¹tandardne be¾í s právami roota,
  aby mohol zmeni» identitu na pou¾ívateµa, ktorému doruèuje po¹tu (aj toto je
  mo¾né zmeni», ale treba si pre¹tudova» manuál). Klientský program
  "<code>spamc</code>" je napísaný v jazyku C a pri jeho spú¹»aní teda
  nevzniká oneskorenie ako pri perlovskej verzii.

  <P ALIGN="justify">
  V praxi teda staèí oproti predchádzajúcej in¹talácii uskutoèni» tieto
  zmeny:</P>

  <OL>
    <LI> zabezpeèi» spú¹»anie démona "<code>spamd</code>" (najèastej¹ie
    "<code>/usr/local/bin/spamd</code>"). Pri manuálnej in¹talácii treba pou¾i»
    prilo¾ený init-skript (v podadresári "<code>spamd</code>") - je ich
    viacero pre rôzne verzie Unixu/Linuxu. Skontrolujte cesty k programu
    "<code>spamd</code>" v skripte a nezabudnite vytvori» symbolické linky
    z adresárov pre jednotlivé runlevely! Ak pou¾ijete balíèkovú distribúciu,
    ¹tartovací skript je u¾ vytvorený; na Debiane nezabudnite skontrolova»
    súbor "<code>/etc/default/spamassassin</code>" a nastavi» potrebné
    parametre, najmä v¹ak parameter "<code>ENABLE=1</code>". Bez tohto
    parametra sa <code>SpamAssassin</code> pri ¹tarte servera <b>nespustí</b>.
    <LI> zameni» volanie programu "<code>/usr/local/bin/spamassassin</code>"
    v súbore "<code>.procmailrc</code>" resp. "<code>.mailfilter</code>"
    volaním programu "<code>/usr/local/bin/spamc</code>"
    <LI> spusti» démona "<code>spamd</code>" pomocou init-skriptu:
    "<code><b>/etc/init.d/spamd start</b></code>"(automaticky sa bude spú¹»a»
    po ¹tarte servera)
  </OL>

  <P ALIGN="justify">
  Nasleduje opätovné testovanie funkènosti. Ak Vám doruèovanie mailov funguje,
  v¹etko je v poriadku.

  <p class="poznamka">
  <b>Poznámka:</b> mo¾no Vás napadla otázka: "èo sa stane s mailami v prípade,
  ¾e démon na kontrolu SPAMu spadne?". Odpoveï je na¹»astie jednoduchá
  a podarilo sa mi ju aj otestova». Ak sa programu "spamc" nepodarí pripoji»
  na démona, jednoducho sa mail doruèí bez filtrovania. Po¹ta sa teda
  nestratí.
  
  <A NAME="spamassassin_tweaking"></A>
  <H3>6.3.6 Ladenie programu SpamAssassin</H3>

  <P ALIGN="justify">
  Nech je program "<code>SpamAssassin</code>" akokoµvek perfektný, jeho
  nastavenie nemusí vyhovova» ka¾dému. Niekto mô¾e po¾adova» citlivej¹ie,
  niekto benevolentnej¹ie detekovanie SPAMu. Niekto dokonca bude chcie»
  upravi» skóre pre jednotlivé testy. Pre toto a v¹elièo iné existuje mo¾nos»,
  ako nastavenie programu "<code>SpamAssassin</code>" upravi».

  <A NAME="spamassassin_tweaking_config"></A>
  <H4>6.3.6.2 Konfiguraèný súbor programu SpamAssassin</H4>

  <P ALIGN="justify">
  Globálny lokálny konfiguraèný súbor (nádherné pomenovanie, len èo je pravda
  ;-) pre "<code>SpamAssassin</code>" je umiestnený
  v "<b><code>/etc/mail/spamassassin/local.cf</code></b>", prípadne
  v "<code>/etc/spamassassin/local.cf</code>" a mô¾e obsahova» napríklad tieto
  nastavenia:

  <pre class="example">
  # prepisat Subject: na "****SPAM**** (povodny subject)"
  rewrite_subject 1
  
  # nevykonavat kontrolu adresy odosielatela mailu na verejnych RBL (real
  # black listing) serveroch - vyrazne to zrychluje pracu a je to zbytocne
  # v pripade, ze tieto kontroly za vas vykonava mailovy server
  skip_rbl_checks 1

  # vkladat originalny SPAM do samostatnej prilohy (starsie verzie to nerobili
  # a napr. HTML maily neboli uz potom citatelne)
  report_safe 1

</pre>

<P ALIGN="justify">
  Ak Vám to nestaèí (nestaèí!), pozrite si dokumentáciu príkazom

  <pre class="example"><b>
      perldoc Mail::SpamAssassin::Conf
  </b></pre>

  <A NAME="spamassassin_tweaking_learning"></A>
  <H4>6.3.6.3 Uèenie sa na vzorkách</H4>

  <P ALIGN="justify">
  Program "<code>SpamAssassin</code>" vyu¾íva pri svojej èinnosti tzv.
  Bayesovské filtre, ktoré majú za úlohu priebe¾ne vyhodnocova» v¹etky maily,
  ktoré sa dostanú do Va¹ej schránky. Pri kontrole mailov vytvára
  "<code>SpamAssassin</code>" databázu, do ktorej zapisuje rôzne údaje
  - napríklad pre odosielateµov, od ktorých èasto dostávate po¹tu, automaticky
  predpokladá, ¾e mail s vysokou pravdepodobnos»ou nie je SPAM. Mimochodom,
  rovnaké samouèiace sa mechanizmy doká¾e pou¾íva» aj <A
    HREF="http://www.mozilla.org/">Mozilla</A> od verzie 1.3 a vy¹¹ej.
  
  <P ALIGN="justify">
  Bez toho, aby som vysvetµoval, ako funguje (priznám sa, ¾e sám to zatiaµ
  nechápem) Vám prezradím, na èo je táto sranda dobrá.

  <P ALIGN="justify">
  V praxi sa Vám isto stane, ¾e okrem detekovaných SPAMov sa vo Va¹ich
  schránkach budú aj naïalej objavova» aj maily, ktoré
  "<code>SpamAssassin</code>" nezachytí, hoci by mal. Takéto maily je vhodné
  uchováva» v jednom samostatnom prieèinku a z èasu na èas na týchto mailoch
  spusti» program "<code>sa-learn</code>". Tento program slú¾i na "uèenie sa"
  "<code>SpamAssassina</code>", konkrétne na uèenie sa Bayesovských filtrov.
  Podµa rôznych materiálov sa odporúèa vytrénova» filtre na vzorke pribli¾ne
  1000 SPAMov a 1000 normálnych mailov. Po tomto uèení sa sú Bayesovské filtre
  schopné zachyti» SPAM s vysokou úèinnos»ou.

  <P ALIGN="justify">
  Osobne som nemal poruke 1000 SPAMov, na ktorých by som program trénoval,
  preto som pou¾íval iba priebe¾né trénovanie a dnes (po niekoµkých mesiacoch)
  u¾ be¾ne dostávam maily, ktoré Bayes oznaèí za "SPAM s 90%-tnou
  pravdepodobnos»ou", za èo v koneènom dôsledku získa mail v celkovom skóre
  minimálne 3 body.</P>

  <P ALIGN="justify">Program "<code>sa-learn</code>" sa pou¾íva veµmi
  jednoducho. Staèí zada» jeden z parametrov "<code>--spam</code>" (uèíme sa
  zo SPAMu) alebo "<code>--ham</code>" (uèíme sa z ne-SPAMovej po¹ty), ïalej
  formát po¹tovej schránky (súbor, adresár) a jej meno. V jednom uèiacom cykle
  mô¾ete zada» aj viacero schránok (súborov, adresárov).</P>

  <p align="justify">
  Ak chcete trénova» "<code>SpamAssassina</code>" pravidelne, najlep¹ie je vytvori» si na
  tento úèel samostatný prieèinok, do ktorého budete odhadzova» iba SPAM.</p>

  <p align="justify">
  V¹eobecná syntax príkazu "<code>sa-learn</code>" je nasledovná:</p>

  <pre class="example">sa-learn [--mbox|--file|--dir] meno1 meno2 .. menoN</pre>
  
  <p align="justify">
  Formát po¹tovej schránky mô¾ete vybra» z:</p>

  <ol>
      <li> <code>--mbox</code>: klasický spôsob ulo¾enia mailov v jedinom súbore, napr.
      "<code>/var/spool/mail/vix</code>" alebo "<code>~/mail/SPAM</code>"

      <li> <code>--file</code>: súbor, ktorý obsahuje presne jeden mail (napr.
      ak ulo¾íte mail z Vá¹ho mailového klienta)

      <li> <code>--dir</code>: adresár vo formáte "<code>Maildir</code>"
      (pou¾íva sa najèastej¹ie s mailovým serverom "qmail"). V takomto
      adresári je ka¾dý mail ulo¾ený vo vlastnom súbore.
  </ol>
  
  <p align="justify"><b>Príklad 1</b>: nauè sa zo SPAMu zo schránky ~/mail/SPAM:</p>
  
  <pre class="example">sa-learn --spam --mbox ~/mail/SPAM</pre>

  <p align="justify"><b>Príklad 2</b>: nauè sa zo SPAMu z ulo¾eného mailu (súbor obsahuje iba tento
  mail):</p>

  <pre class="example">sa-learn --spam --file spam.txt</pre>

  <p align="justify"><b>Príklad 3</b>: nauè sa zo SPAMu z niekoµkých ulo¾ených
  mailov (ka¾dý súbor obsahuje iba jeden mail):</p>

  <pre class="example">sa-learn --spam --file spam1.txt spam2.txt spam3.txt</pre>
  
  <p align="justify"><b>Príklad 4</b>: nauè sa zo SPAMu z adresára ~/Maildir:</p>

  <pre class="example">sa-learn --spam --dir ~/Maildir</pre>
  
  <p align="justify"><b>Príklad 4</b>: nauè sa na dobrej po¹te zo schránky /var/spool/mail/vix
  
  <pre class="example">sa-learn --ham --mbox /var/spool/mail/vix</pre>

  <p class="poznamka">
  <b>Poznámka:</b> Od verzie
  "<code>SpamAssassina</code>" 2.60 sa mení odporúèaný formát internej
  bayesovskej databázy, prièom máte mo¾nos» skonvertova» bayesovské databázy
  vytvorené star¹ími verziami programu. Pokiaµ ste pou¾ívali star¹iu verziu,
  upgradli ste ju a nefunguje Vám Bayes, musíte skonvertova» databázy
  príkazom: <code><b>sa-learn --import</b></code>. Túto konverziu je potrebné
  vykona» iba raz pre ka¾dého pou¾ívateµa, ktorý pou¾íva
  "<code>SpamAssassin</code>".<br>
  Takáto zmena interného formátu je samozrejme veµmi nepríjemná zále¾itos»
  a viete si predstavi», ako ma prekvapilo, keï mi po takomto upgrade Bayes
  nechodil. V tej verzii "<code>SpamAssassina</code>" v¹ak nefungoval (nebol
  dokumentovaný) ani spôsob importu ;-) Máloktorý upgrade som tak rýchlo
  vracal na pôvodnú verziu. Na druhej strane musím prizna», ¾e s novým
  formátom databázy sa pracuje o dos» rýchlej¹ie.
  </p>

  <A NAME="pop3imap"></A>
  <H2>6.4 Slu¾by na výber mailov (POP3, IMAP)</H2>

  <P ALIGN="justify">
  Maily sa nám doruèujú, v¹etko vyzerá výborne, ale má to jednu malú chybièku:
  ako sa k mailom dostaneme? Ak majú pou¾ívatelia konto so shellom na serveri,
  ktorý maily prijíma, je to úplne jednoduché, preto¾e na výber mailov
  nepotrebujú nijaké ¹peciálne protokoly a postupy. Nevýhodou tohto rie¹enia
  je v¹ak práve fakt, ¾e pou¾ívatelia musia ma» vytvorené konto so shellom,
  aby mohli spú¹»a» mailového klienta. Ak maily prijíma a doruèuje firewall,
  najlep¹ím rie¹ením je preposielanie mailov na mail server vo vnútornej
  sieti, na ktorom u¾ pou¾ívatelia mô¾u ma» kontá. Vonkaj¹í server funguje iba
  ako brána pre posielanie mailov. Ak takéto nastavenie nie je
  mo¾né, prichádza do úvahy e¹te výber mailov pomocou protokolov POP3
  a IMAP z vnútornej siete.

  <P ALIGN="justify">
  Niekedy (napr. na ¹kolách) nie je mo¾né zabezpeèi», aby funkciu firewallu
  a mailového servera vykonával samostatný a iba na to urèený poèítaè. Je to
  ¹koda, ale tak to proste chodí. Na druhej strane, aj v takýchto prípadoch je
  ¾iadúce, aby sa pou¾ívatelia vnútornej siete dostali k svojim mailom pomocou
  ich obµúbených e-mailových klientov zo svojich poèítaèov. Tak¾e slu¾by POP3
  a IMAP predsa len budeme potrebova». Zároveò to v¹ak znamená, ¾e pou¾ívatelia
  nebudú nevyhnutne potrebova» shell na serveri.
  
  <P ALIGN="justify">
  V tomto momente treba poveda», ¾e nastavenie servera pre spú¹»anie POP3
  a/alebo IMAP servera je v podstate triviálne, preto¾e sa takmer stopercentne
  pou¾íva "<code>inetd</code>", v ktorom sú vhodné riadky èasto u¾ aj napísané, hoci aj
  zakomentované. Oveµa zlo¾itej¹ie je zabezpeèenie týchto slu¾ieb. Preèo?</P>

  <OL>
  <LI> obslu¾né démony pre výber mailov sa spú¹»ajú zásadne pod
  rootom, po autentifikácii pou¾ívateµa be¾ia s jeho identitou. Akákoµvek
  snaha o preniknutie na server prostredníctvom týchto slu¾ieb (a najmä
  úspe¹ná) je nebezpeèná pre ïal¹í beh servera. Prístup na tieto slu¾by by mal
  by» obmedzený, najlep¹ie iba z vnútornej siete. Na obmedzenie mô¾ete pou¾i»
  <A HREF="tcp_wrappers.html">TCP wrapper</A> a/alebo firewall.
  <LI> protokoly POP3 a IMAP pri autentifikácii <b>ne¹ifrujú</b> heslo
  pou¾ívateµa, preto je ho mo¾né zachyti» kdekoµvek na ceste medzi klientom
  a serverom. Ak je povolené pou¾ívanie týchto slu¾ieb iba z vnútornej siete,
  ktorá je implementovaná ako prepínaný Ethernet (pomocou switchov),
  nebezpeèenstvo nie je veµké. Ak je v¹ak potrebné sprístupni» POP3 a IMAP
  zvonku, je nevyhnutné pou¾i» ¹ifrovanie!
  </OL>

  <A NAME="pop3imap_tcpwrapped"></A>
  <H3>6.4.1 Obmedzenie prístupu k slu¾bám POP3 a IMAP</H3>

  <P ALIGN="justify">
  V nasledujúcej uká¾ke pou¾ijeme na obmedzenie prístupu TCP wrapper
  (predpokladá sa, ¾e POP3, resp. IMAP slu¾by sa spú¹»ajú
  z "<code>inetd</code>") Predpokladá sa, ¾e lokálna (vnútorná) sie» má adresu
  192.168.1.0/255.255.255.0.</P>

<P ALIGN="justify"><b><code>/etc/hosts.deny</code>:</b></P>

<pre class="example">
ALL:ALL
### koniec suboru hosts.deny
</pre>

<P ALIGN="justify"><b><code>/etc/hosts.allow</code>:</b></P>

<pre class="example">
ipop3d: 192.168.1.
imapd:  192.168.1. 127.0.0.1

### koniec suboru hosts.allow
</pre>

<P ALIGN="justify"><b><code>/etc/inetd.conf</code>:</b></P>

<pre class="example"><b>
port   typ     prot.   detaily    user       program         argumenty</b>

imap   stream  tcp     nowait.200 root       /usr/sbin/tcpd  /usr/sbin/imapd
pop3   stream  tcp     nowait     root       /usr/sbin/tcpd  /usr/sbin/ipop3d
</pre>

<p class="poznamka">
<b>Poznámka:</b> Èíslo "200" v riadku
"imap" urèuje poèet spojení, ktoré mo¾no uskutoèni» v priebehu jednej minúty.
Toto èíslo je úmyselne explicitne zvý¹ené kvôli problémom s prihlasovaním sa
na webmail (<a href="http://www.horde.org/">Horde</a>/<a
    href="http://www.horde.org/projects/imp/">IMP</A>). So ¹tandardným
nastavením sa Vám nepodarí prihlási» na webmail, ak sa bude naraz prihlasova»
väè¹ia skupina µudí (napr. celá uèebòa).</p>

<P ALIGN="justify">
Pre aktualizáciu údajov treba re¹tartova» inetd zaslaním signálu HUP ("<b><code>killall
-HUP inetd</code></b>") alebo spustením "<b><code>/etc/init.d/inetd reload"</code></b>.
  
<A NAME="stunnel"></A>
<H3>6.4.2 Tunelovanie &amp; ¹ifrovanie: stunnel</H3>

<P ALIGN="justify">
Program "<code>stunnel</code>" je u¾itoèná utilita, ktorá vám umo¾ní pou¾íva»
¹ifrovanie pri prená¹aní údajov aj pri tých slu¾bách, ktoré normálne nijaké
¹ifrovanie neumo¾òujú. Spomenuli sme, ¾e slu¾by, ktoré sa pou¾ívajú na výber po¹ty,
posielajú meno pou¾ívateµa a jeho heslo v neza¹ifrovanom tvare. Ak aj
pou¾ívate na prihlasovanie na server "<code>ssh</code>", pri èítaní po¹ty
pomocou "<code>pop3" alebo "imap</code>" ste z hµadiska bezpeènosti tam, kde
ste boli pred zavedením "<code>ssh</code>".

<P ALIGN="justify">
Program "<code>stunnel</code>" vytvára bezpeèný kanál medzi aplikáciou
a serverom. Pou¾íva na to funkcie kni¾nice "<code>openssl</code>". Princíp
tunelovania protokolu "<code>pop3</code>", "<code>imap</code>" resp.
akéhokoµvek iného protokolu, ktorý by ste chceli pou¾i» s programami typu
"<code>stunnel</code>" je takýto:

<P ALIGN="justify">
Stav pred zavedením "<code>stunnel</code>": klient elektronickej po¹ty sa
pripája na server na port "pop3" (110) resp. "imap" (143):

<pre>
 +------------------+  (login, password)           +------------------+
 |                  |  <FONT COLOR="red">-----------------------&gt;</FONT>    |                  |
 | Klient el. po¹ty |  <FONT COLOR="red">&lt;----------------------</FONT>     | Server pop3/imap |
 |                  |        (e-mailové správy)    |                  |
 +------------------+                              +------------------+
                       <FONT COLOR="red">ne¹ifrovaný kanál (sie»)</FONT>
</pre>

<P ALIGN="justify">
Po zavedení "<code>stunnel</code>": klient elektronickej po¹ty sa pripája na
port "<code>pop3s</code>" (995), ktorý obsluhuje démon "<code>stunnel</code>".
Komunikácia s "<code>stunnelom</code>" je ¹ifrovaná, nikto teda nemô¾e
zachyti» na sieti va¹e heslo. "<code>stunnel</code>" sa následne
<b>lokálne</b> pripojí na port "<code>pop3</code>" a odovzdá prihlasovacie
meno a heslo pou¾ívateµa. "<code>stunnel</code>" vystupuje ako transparentný
prostredník medzi klientom a serverom.

<pre>
 +-----------------------+ (login, password)          +-----------------------+
 |                       | <FONT COLOR="green">-----------------------&gt;</FONT>   |                       |
 | Klient el. po¹ty      | <FONT COLOR="green">&lt;----------------------</FONT>    | STUNNEL               |
 |                       |       (e-mailové správy)   |                       |
 +-----------------------+                            +-----------------------+
                            <FONT COLOR="green">¹ifrovaný kanál (sie»)</FONT><FONT COLOR="blue">     |                     ^
                                                     / |(login, password)    |
                                                    .  |                     |
                             spojenie cez localhost .  |                     |
                                                     \ v  (e-mailové správy) |</FONT>
                                                      +-----------------------+
                                                      |                       |
                                                      | Server pop3/imap      |
                                                      |                       |
                                                      +-----------------------+
</pre>

<P ALIGN="justify">
Ak pou¾ívate na va¹ej sieti klientov, ktorí nepodporujú ¹ifrovanie
"<code>pop3</code>" resp. "<code>imap</code>", máte o jeden problém viac.
V takom prípade treba spusti» program "<code>stunnel</code>" aj na strane
klienta, aby dáta pochádzajúce od ne¹ifrujúceho klienta za¹ifroval
a komunikoval so "<code>stunnelom</code>" na druhej strane - teda na serveri:

<pre>
 +-----------------------+ 
 |                       |
 | Klient el. po¹ty      |
 |                       |
 +-----------------------+
  <FONT COLOR="blue">|(login, password)    ^
  |                     | \
  |                     |  .
  |                     |  . spojenie cez localhost
  v  (e-mailové správy) | /</FONT>
 +-----------------------+ (login, password)          +-----------------------+
 |                       | <FONT COLOR="green">-----------------------&gt;</FONT>   |                       |
 | STUNNEL               | <FONT COLOR="green">&lt;----------------------</FONT>    | STUNNEL               |
 |                       |       (e-mailové správy)   |                       |
 +-----------------------+                            +-----------------------+
                                                       <FONT COLOR="blue">|                     ^
                                                    /  |(login, password)    |
                             spojenie cez localhost .  |                     |
                                                    .  |                     |
                                                    \  v  (e-mailové správy) |</FONT>
                                                      +-----------------------+
                                                      |                       |
                                                      | Server pop3/imap      |
                                                      |                       |
                                                      +-----------------------+
</pre>

<P ALIGN="justify">
Tento problém s väè¹inou dostupných a pou¾ívaných klientov na¹»astie odpadá
a staèí vytvori» jednu "stranu" tunela - na serveri, èo je presne prípad,
ktorý sme si opísali vy¹¹ie.

<P ALIGN="justify">
Ak teda pou¾ívate na va¹ej sieti iba klientov, ktorí sa vedia pripája» pomocou
¹ifrovaného spojenia (Mozilla, Microsoft Outlook, Microsoft Outlook Express,
Eudora a urèite aj ïal¹ie), mô¾ete pripojenie na "<code>pop3" a "imap</code>"
neskôr pomocou firewallu zo siete celkom zakáza», preto¾e
"<code>stunnel</code>" sa na tieto porty bude pripája» výluène lokálne
(pomocou "<code>localhost</code>" resp. "<code>127.0.0.1</code>").

<A NAME="stunnel_config"></A>
<H4>6.4.2.1 Konfigurácia</H4>

<P ALIGN="justify">
Existujú dva spôsoby, ako nastavi» "<code>stunnel</code>": aby sa spú¹»al ako samostatný
démon pre obsluhu ka¾dej tunelovanej slu¾by, alebo aby sa spú¹»al z démona
"<code>inetd</code>". Pre konkrétnu implementáciu sa rozhodnite podµa toho, ako èasto
budete obsluhu slu¾by vy¾adova» (preèítajte si èas» "<A
HREF="services.html#inetdvsstandalone">Inetd versus samostatné slu¾by</A>").

<A NAME="stunnel_config_standalone"></A>
<H5>6.4.2.1.1 Samostatne spú¹»aný démon</H5>

<P ALIGN="justify">
V prípade, ¾e budete "<code>stunnel</code>" pou¾íva» vo forme samostatného démona, treba
zabezpeèi» jeho spustenie po ¹tarte servera napríklad prostredníctvom skriptu
v "<code>/etc/init.d</code>". Nasledujúce riadky platia pre distribúciu
"Debian", ktorá má upravený ¹tartovací skript:

<P ALIGN="justify">
Riadiaci skript "<code>stunnel</code>" sa nachádza v "<code>/etc/init.d/stunnel</code>". Po spustení
naèíta konfiguráciu zo súboru "<code>/etc/stunnel.conf</code>", èím uµahèuje nastavenie.

<P ALIGN="justify">
Dôle¾ité direktívy konfiguraèného súboru:</P>
<DL>
<DT><b>SERVERCERT cesta</b></DT>
<DD>cesta k certifikátu</DD>

<DT><b>TUNNEL port cesta -- meno_demona</b></DT>
<DD>urèuje jednotlivé "tunely", èi¾e porty, na ktorých bude "stunnel" poèúva».
"Cesta" urèuje umiestnenie obslu¾ného démona. "meno_demona" vyu¾ijete pri
obmedzení prístupu pomocou <A HREF="tcp_wrappers.html">TCP wrappera</A>.
</DD>
</DL>

<pre class="example">
#!/bin/bash

# stunnel configuration file
# by Steve Haslam

# Level of verification to use [-v]
VERIFY 1

# Certificate for server mode [-p]
# cesta k certifikatu
SERVERCERT /etc/ssl/certs/stunnel.pem

# Trusted certs directory for VERIFY 3 [-a]
#TRUSTEDCERTS /etc/ssl/certs

# Tunnel definitions (daemon mode)
# definicie tunelov, ak bezi stunnel ako demon

#TUNNEL imaps /usr/sbin/imapd -- imapd
# tunel pre sifrovanie imap pomocou imaps; tu: nepouzivane

TUNNEL pop3s /usr/sbin/solid-pop3d -- solid-pop3d
# tunel pre sifrovanie pop3 pomocou pop3s
</pre>

<P ALIGN="justify">
Ak nemáte distribúciu "Debian" alebo sa vám z mne neznámeho dôvodu pri in¹talovaní
nevytvoril konfiguraèný súbor "<code>/etc/stunnel.conf</code>", nezúfajte. V skutoènosti
staèí pozna» niekoµko parametrov a mô¾ete zariadi» spú¹»anie "<code>stunnel-a</code>" sami.

"<code>stunnel</code>", ktorý zabezpeèuje tunelovanie protokolu "<code>pop3</code>" na obslu¾ného démona
"<code>solid-pop3d</code>" vyzerá takto:

<pre class="example"><b>
/usr/sbin/stunnel -v 1 -p /etc/ssl/certs/stunnel.pem -d pop3s -l /usr/sbin/spop3d -- solid-pop3d</b></pre>

<P ALIGN="justify">
(príkaz treba zada» v jednom riadku!)

<P ALIGN="justify">
Parametre:
<UL>
<LI> <code>-v èíslo</code>: verifikácia klienta pomocou certifikátu. Hodnota "<code>1</code>": iba v prípade,
¾e existuje certifikát klienta. V prípade problémov skúste parameter "<code>-v</code>"
úplne odstráni».
<LI> <code>-p cesta</code>: cesta k súboru s PEM certifikátom servera
<LI> <code>-l program -- meno</code>: cesta k obslu¾nému démonovi slu¾by (spustí ho
"<code>stunnel</code>", keï príde po¾iadavka). Za "<code>--</code>" uveïte meno programu, na základe
tohto mena mô¾ete neskôr vytvori» pravidlá <A HREF="tcp_wrappers.html">TCP
wrappera</A>
<LI> <code>-d port</code>: èíslo alebo meno portu, na ktorom má "<code>stunnel</code>" poèúva»
</UL>

<P ALIGN="justify">
<b>Príklad: v prípade, ¾e pou¾ívate na obsluhu "<code>pop3</code>" iného démona, napr.
"<code>ipop3d</code>":</b>

<pre class="example"><b>
/usr/sbin/stunnel -v 1 -p /etc/ssl/certs/stunnel.pem -d pop3s -l /usr/sbin/ipop3d -- ipop3d</b></pre>

<A NAME="stunnel_conf_inetd"></A>
<H5>6.4.2.1.2 Spú¹»anie "<code>stunnel</code>" z "<code>inetd</code>"</H5>

<P ALIGN="justify">
Princíp spú¹»ania je úplne rovnaký, nebude v¹ak editova» ¹tartovací skript,
ale súbor "<code>/etc/inetd.conf</code>". Uká¾ka, tentokrát pre tunelovanie
"<code>imap</code>":

<P ALIGN="justify">
Pred zmenou:</P>

<pre class="example">
imap   stream  tcp     nowait.200 root       /usr/sbin/tcpd  /usr/sbin/imapd
</pre>

<P ALIGN="justify">
Po zmene:
</P>

<pre class="example">
imap   stream  tcp     nowait.200 root       /usr/sbin/tcpd  /usr/sbin/stunnel -v 1 -p /etc/ssl/certs/stunnel.pem -d imaps -l /usr/sbin/imapd -- imapd
</pre>

<P ALIGN="justify">
(príkaz treba zada» v <b>jednom riadku</b>)

<A NAME="stunnel_certificate"></A>
<H4>6.4.2.2 Vytvorenie certifikátu</H4>

<P ALIGN="justify">
Pre pou¾ívanie démona "<code>stunnel</code>" treba e¹te vygenerova» certifikát
pre server (bez neho by vám napríklad "Outlook Express" ¹karedo nadával v¾dy
pri s»ahovaní po¹ty). Program je na¹»astie vybavený "jednoriadkovým helpom",
ktorý sa vypí¹e priamo po in¹talácii balíèka:

<pre class="example">
To build a new pem, execute the following OpenSSL command:
    openssl req -new -x509 -days 365 -nodes \
    -config /usr/share/doc/stunnel-3.20/stunnel.cnf \
    -out /etc/ssl/certs/stunnel.pem -keyout /etc/ssl/certs/stunnel.pem
</pre>
    
<P ALIGN="justify">
Tak¾e tieto tri riadky treba skopírova» do príkazového riadku, spusti»
a odpoveda» na otázky. Certifikát sa sám sebou podpí¹e a ulo¾í do súboru
"<code>/etc/ssl/certs/stunnel.pem</code>". Platnos» certifikátu je jeden rok
(365 dní).

<P ALIGN="justify" class="pozor">
<b>Pozor!</b> Ako ste si v¹imli, cesta k "<code>stunnel.cnf</code>" závisí od
èísla verzie, preto pou¾íte výpis vá¹ho konkrétneho balíèka.

<A NAME="stunnel_client_config"></A>
<H4>6.4.2.3 Konfigurácia klienta</H4>

<P ALIGN="justify">
Konfigurácia klienta je väè¹inou jednoduchá, len treba nájs» tie správne
za¹krtávacie polo¾ky. Uká¾ka pre "<code>Outlook Express</code>", ktorý jediný
som mal pre screenshoty k dispozícii:

<P>
<b>Krok 1</b>: vyberte menu "Nástroje" a "Kontá":</P>
<CENTER>
<IMG SRC="pictures/express08.gif" ALT="Nastavenie Outlook Express (1)">
</CENTER>

<BR CLEAR="all">
<P>
<b>Krok 2</b>: Pre nastavované konto elektronickej po¹ty vyberte "Vlastnosti":
</P>

<CENTER>
<IMG SRC="pictures/express09.gif" ALT="Nastavenie Outlook Express (2)">
</CENTER>

<BR CLEAR="all">
<P>
<b>Krok 3</b>: Za¹krtnite mo¾nos» "Tento server vy¾aduje bezpeèné spojenie (SSL)" pre
<b>Prichádzajúcu po¹tu!!</b> Èíslo portu sa zmení zo "110" (pop3) na "995"
(pop3s), resp. "143" na "993" (imaps):</P>
<CENTER>
<IMG SRC="pictures/express10.gif" ALT="Nastavenie Outlook Express (3)">
</CENTER>
<BR CLEAR="all">

<A NAME="stunnel_combined"></A>
<H3>6.4.3 Kombinovaný prístup</H3>

<P ALIGN="justify">
Obe metódy (obmedzovanie prístupu a ¹ifrovanie) mô¾ete aj kombinova».
V nasledujúcom príklade platí obmedzenie slu¾ieb POP3 a IMAP z vnútornej siete
a slu¾bu POP3 so ¹ifrovaním mô¾e vyu¾íva» ka¾dý poèítaè v Internete, ktorý
nefal¹uje svoj DNS záznam:</P>

<P ALIGN="justify"><b><code>/etc/hosts.allow</code>:</b></P>

<pre class="example">
ipop3d: 192.168.1.
imapd:  192.168.1. 127.0.0.1
solid-pop3d: ALL EXCEPT PARANOID

### koniec suboru hosts.allow
</pre>

<CENTER>
<TABLE WIDTH="75%" BORDER="0">
<TR>
<TD WIDTH="33%" ALIGN="center"><A HREF="security.html">Spä» (Druhy útokov na
server v sieti)</A></TD>
<TD WIDTH="33%" ALIGN="center"><A HREF="index.php">Obsah</A></TD>
<TD WIDTH="33%" ALIGN="center"><A HREF="proxy.html">Ïalej (Proxy server)</A></TD>
</TR>
</TABLE>
</CENTER>
<HR>
<P ALIGN="right">&copy; Ivan "VIX" Noris, 2002-2005<BR>
mail: vix (zavinac) deja-vix bodka sk</P>



  </BODY>
</HTML>


